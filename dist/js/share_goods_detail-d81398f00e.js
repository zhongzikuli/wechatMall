function bindCustNumber(){var e=$.trim($("#newCustNumber").val());if(null==e||""==e)return void $.toast("身份证号码未录入");if(18!=e.length)return void $.toast("身份证号码长度不正确，请检查");$.showIndicator();var t={interId:"toc.updateCustNumberInfo",channel:"C",custId:custId,custNumber:e};xhq.__runXHQ(t,function(t){$.hideIndicator(),0==t.status?(setLocalSession("custNumber",e),$(".bind_id").css("display","none"),$(".cover").css("display","none"),gotoBuyPub(channel,fromCustId)):$.toast(t.message)})}function bindPhone(){var e=$.trim($("#newPhoneNo").val()),t=$.trim($("#verficode").val());if(null==e||""==e)return void $.toast("手机号码未录入");if(11!=e.length)return void $.toast("手机号码长度不正确，请检查");if(null==t||""==t)return void $.toast("验证码未录入");if(4!=t.length)return void $.toast("验证码长度为4位，请检查");$.showIndicator();var s={interId:"toc.updateCustInfo",channel:"C",custId:custId,phoneNo:e,verificationCode:t};xhq.__runXHQ(s,function(t){$.hideIndicator(),0==t.status?(setLocalSession("phoneNo",e),gotoBuyPub(channel,fromCustId)):$.toast(t.message)})}function getDetail(e,t){if(oldOnlineId!=e){oldOnlineId=e,$.showIndicator();var s={interId:"toc.getOnlineDetail",channel:"C",onlineId:e,fromCustId:t};xhq.__runXHQ(s,function(e){if($.hideIndicator(),0==e.status){setData(e.body),globalStatus=e.body.status,globalNeedVerify=e.body.needVerify;var t=window.location.search;shareConfig={title:e.body.showName||"全民集市精品分享",desc:"我在全民集市发现了一个不错的商品，快来看看吧。",link:xhq.getDomainUrl()+"share_goods_detail.html"+t+"&"+xhq.getVersion(),imgUrl:(e.body.bigPic||"").trim()},xhq.initWXJsConfig()}else $.toast(e.message)})}}function setData(e){channel=e.channel,topTypeName=e.topTypeName,$(".wx_text").html(e.sharerName||""),$(".wx_pic").html('<img src="'+(e.sharerImg||"")+'" alt="">'),description=editHTML(e.description),$(".text_goods").html(description),specDescription=editHTML(e.specDescription),$(".parameter").html(specDescription),maintainDesction=editHTML(e.maintainDesction),$(".to_know").html(maintainDesction),$(".test-lazyload").picLazyLoad({threshold:100});var t=e.ggs;if(t&&t.length){var s="";for(var i in t){var n=oldOnlineId==t[i].online_id?"spec_list active":"spec_list";s+='<span class="'+n+'" id='+t[i].online_id+">"+t[i].ggValue+"</span> "}$(".spec_item").html(s)}if($(".spec_item").on("tap",".spec_list",function(){$(this).attr("id")!=oldOnlineId&&($("#"+oldOnlineId).removeClass("active"),$(this).addClass("active"),getDetail($(this).attr("id"),fromCustId))}),e.images&&""!=e.images){var a=e.images.split(",");if(a.length){var o='<div class="swiper-wrapper">';for(var i in a)o+='<div class="swiper-slide"><img src="'+a[i].trim()+'" alt=""></div>';if(o+='</div><div class="swiper-pagination"></div>',$(".swiper-container").html(o),a.length>1){new Swiper(".swiper-container",{pagination:".swiper-pagination",paginationClickable:!0,spaceBetween:30,centeredSlides:!0,autoplay:2500,autoplayDisableOnInteraction:!1})}}}var r=(e.purchasePrice||0)/100,d=0==parseInt(r)||""==r?"":'<span class="price_two">&yen;'+r+"</span>",l=""==(e.endTime||"")?"":'<span class="end_time"><span>'+e.endTime+"</span>结束</span>",c=""==(e.startTime||"")?"":'<span class="end_time"><span>'+e.startTime+"</span>开始抢购<span>";briefHtml='<div class="brief_title">'+e.showName+"</div>",briefHtml+='<div class="brief_price"><p class="p_l"><span class="price_one">特卖价</span><span class="span_m">&yen;'+(e.salePrice||0)/100+"</span>"+d+'</p><p class="p_r">'+l+c+"</p></div>",$(".goods_brief").html(briefHtml),1==e.status?$(".goods_state").children("img").attr("src","../img/jinxingzhong.png"):2==e.status?$(".goods_state").children("img").attr("src","../img/yishouwan.png"):3==e.status?$(".goods_state").children("img").attr("src","../img/weikaishi.png"):4==e.status&&$(".goods_state").children("img").attr("src","../img/yijieshu.png"),setFoot(e),initOrderJson(e)}function initOrderJson(e){orderJson={showName:e.showName,mailMoney:e.mailMoney,salePrice:e.salePrice,onlineId:e.onlineId,bigPic:e.bigPic,goodId:e.skuId,purchasePrice:e.purchasePrice,num:0}}function setFootDisable(e){$(".subtract").attr("disabled","disabled"),$(".add").attr("disabled","disabled"),$(".go_change").attr("disabled","disabled"),$(".go_change").css("background","rgb(156,156,156)")}function setFootAble(e){2==e?($(".subtract").attr("disabled","disabled"),$(".add").attr("disabled","disabled")):($(".subtract").attr("disabled",null),$(".add").attr("disabled",null)),$(".go_change").attr("disabled",null),$(".go_change").css("background","rgb(222,63,55)")}function setFoot(e){2==e.channel||1==e.channel&&e.needVerify?1==e.status?setFootAble(2):setFootDisable(2):1==e.status?setFootAble(1):setFootDisable(1)}var openId,custId,oldOnlineId,fromCustId,channel,orderJson,shareConfig,globalStatus=1,topTypeName="",globalNeedVerify;$(function(){if(openId=getLocalSession("openid")||"",custId=getLocalSession("custId")||"",""==openId||""==custId)return void xhq.gotoErrorPage();var e=xhq.getQuery("onlineId");fromCustId=xhq.getQuery("fromCustId")||0,getDetail(e,fromCustId),$(".wx_box").hide(),$(".add").on("tap",function(){if(!$(this).attr("disabled")){var e=$(".num_handle");e.val(parseInt(e.val())+1)}}),$(".subtract").on("tap",function(){if(!$(this).attr("disabled")){var e=$(".num_handle");e.val(parseInt(e.val())-1),parseInt(e.val())<1&&e.val(1)}}),$("#buy_now").on("tap",function(){if(!$(this).attr("disabled")){var e=getLocalSession("userType");if(2==channel&&1==e)return $.toast("这是一元换购商品，只有成为会员才能购买"),void xhq.gotoRegUrl();orderJson.num=$(".num_handle").val(),refreshOrderCache(orderJson);var t=getLocalSession("phoneNo"),s=getLocalSession("custNumber"),i=new RegExp("^(13[0-9]|15[012356789]|17[0135678]|18[0-9]|14[57])[0-9]{8}$","ig");null!=t&&void 0!=t&&i.test(t.trim())||!globalNeedVerify||1!=globalStatus?null!=s&&void 0!=s&&""!=s||"网咖"!=topTypeName||1!=globalStatus?gotoBuyPub(channel,fromCustId):($(".bind_id").css("display","block"),$(".cover").css("display","block")):($(".bind_phone").css("display","block"),$(".cover").css("display","block"))}}),$(".bind_cancle").on("tap",function(){"网咖"==topTypeName?($(".bind_id").css("display","none"),$(".cover").css("display","none")):($(".bind_phone").css("display","none"),$(".cover").css("display","none"))}),$(".bind_comfir").on("tap",function(){"网咖"==topTypeName?bindCustNumber():bindPhone()}),2==xhq.getQuery("fromUserType")?($(".toshop").show(),$(".tohome").hide()):($(".tohome").show(),$(".toshop").hide()),$(".tohome").on("tap",function(){2==getLocalSession("userType")?xhq.gotoUrl("ws_home.html",{isWs:1}):xhq.gotoUrl("home.html")}),$(".toshop").on("tap",function(){xhq.gotoUrl("ws_shop.html")}),$("#btnGetCode").on("tap",function(e){var t=$.trim($("#newPhoneNo").val());xhq.tobGetVerificationCode($(this),t,function(){$.toast("验证码已发送")})}),wx.ready(function(){wx.onMenuShareAppMessage(shareConfig),wx.onMenuShareTimeline(shareConfig)})});