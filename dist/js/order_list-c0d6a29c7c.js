function openIndicator(){$.showIndicator(),isIndicator=!0}function hideIndicator(){isIndicator&&($.hideIndicator(),isIndicator=!1),loading=!1}var mySwiper=new Swiper(".swiper-container",{width:40,freeMode:!0,noSwiping:!0}),pageNo=0,pageSize=10,$content=null,loading=!1,orderStatus="",cancelStatus="",preTabId=$("#all").attr("id");$(document).ready(function(){function t(){pageNo+=1;var t={interId:"toc.getOrderDetailForPageList",channel:"C",pageNo:pageNo,pageSize:pageSize,custId:m,orderStatus:orderStatus,cancelStatus:cancelStatus};xhq.__runXHQ(t,function(t){if(0==t.status){if(!t.body)return $("#tabContent").html(r(h)),$.detachInfiniteScroll($content),$(".infinite-scroll-preloader").remove(),void hideIndicator();var o=e(t),h="";if(1==pageNo&&0==o.length)return $("#tabContent").html(r(h)),$.detachInfiniteScroll($content),$(".infinite-scroll-preloader").remove(),void hideIndicator();for(var m=0;m<o.length;m++){var p=o[m];"1"==p.orderStatus&&"1"==p.cancelStatus?h+=a(p):"2"==p.orderStatus&&"1"==p.cancelStatus&&"1"==p.orderType?h+=s(p):"2"==p.orderStatus&&"1"==p.cancelStatus&&"0"==p.orderType?h+=n(p):"4"==p.orderStatus&&"1"==p.cancelStatus?h+=l(p):"5"==p.orderStatus&&"1"==p.cancelStatus&&"0"==p.orderType?h+=n(p):"5"==p.orderStatus&&"1"==p.cancelStatus&&"1"==p.orderType&&"5"!=p.sourceType?h+=c(p):"5"==p.orderStatus&&"1"==p.cancelStatus&&"1"==p.orderType&&"5"==p.sourceType?h+=d(p):"6"==p.orderStatus?h+=i(p):"3"==p.cancelStatus&&(h+=u(p))}1==pageNo?$("#tabContent").html(h):$("#tabContent").append(h),(!t.body||t.body.length<pageSize)&&($.detachInfiniteScroll($content),$(".infinite-scroll-preloader").remove()),loading=!1,hideIndicator()}else $.toast(t.message),hideIndicator()})}function e(t){for(var e=[],r=0;r<t.body.length;r++){var o=t.body[r],a={};a.orderId=o.orderId,a.custName=o.custName,a.orderStatus=o.orderStatus,a.cancelStatus=o.cancelStatus,a.orderType=o.orderType,a.groupId=o.groupId,a.sourceType=o.sourceType,a.channel=o.channel;for(var s=o.orderDetails.split("|"),n=[],l=0;l<s.length;l++){for(var d=s[l].split(","),c={},i=0;i<d.length;i++){var u=d[i].split("#");"orderDetailId"==u[0]?c.orderDetailId=u[1]:"orderId"==u[0]?c.orderId=u[1]:"showName"==u[0]?c.showName=u[1]:"purchasePrice"==u[0]?c.purchasePrice=u[1]:"salePrice"==u[0]?c.salePrice=u[1]:"num"==u[0]?c.num=u[1]:"bigPic"==u[0]?c.bigPic=u[1]:"cancelStatus"==u[0]?c.cancelStatus=u[1]:"verifyStatus"==u[0]&&(c.verifyStatus=u[1])}n.push(c)}a.orderDetailList=n,e.push(a)}return e}function r(t){return t+='<div class="content-block-2">',t+='<img src="../img/empty@3x.png" alt="">',t+="<p>还没有相关的订单呢</p >",t+="</div>"}function o(t,e){for(var r=t.orderDetailList,o=0;o<r.length;o++){var a=r[o];e+="<li>",e+='<a href="#" class="item-link item-content">',e+='<div class="item-media"><img src='+a.bigPic+' style="width: 3.5rem;height:3.5rem;">',"3"==a.cancelStatus&&(e+='<div><img src="../img/icon_tui.png" alt=""></div>'),e+="</div>",e+='<div class="item-title-row">',e+='<div class="item-text">'+a.showName+"</div>",3==t.channel?(e+='<div class="item-after"><span>'+a.salePrice+"</span></div>",""!=a.purchasePrice&&"0"!=a.purchasePrice&&(e+='<div class="item-after1"><span>'+a.purchasePrice+"</span></div>")):(e+='<div class="item-after">￥<span>'+a.salePrice/100+"</span></div>",""!=a.purchasePrice&&"0"!=a.purchasePrice&&(e+='<div class="item-after1">￥<span>'+a.purchasePrice/100+"</span></div>")),""!=a.purchasePrice&&"0"!=a.purchasePrice&&(e+='<div class="item-after1">￥<span>'+a.purchasePrice/100+"</span></div>"),e+='<div class="item-after2">x<span>'+a.num+"</span></div>",e+='<div class="item-subtitle"></div>',e+="</div></a></li>"}return e}function a(t){return html='<div class="content-block-1" orderId='+t.orderId+" orderStatus="+t.orderStatus+" cancelStatus="+t.cancelStatus+" orderType="+t.orderType+" sourceType="+t.sourceType+'><div class="order_box">',html+='<div class="order-address">',html+="<span>收货人: "+t.custName+"</span> <button>待支付</button>",html+="</div>",html+='<div class="list-block media-list">',html+="<ul>",html=o(t,html),html+="</ul></div>",html+='<div class="order-function">',html+='<button class="cancel-order">取消订单</button>',html+='<button class="pay" style=" color: rgba(222,63,55,1);">付款</button>',html+="</div>",html+="</div></div>",html}function s(t){return html='<div class="content-block-1" orderId='+t.orderId+" orderStatus="+t.orderStatus+" cancelStatus="+t.cancelStatus+" orderType="+t.orderType+" sourceType="+t.sourceType+'><div class="order_box">',html+='<div class="order-address">',html+="<span>收货人: "+t.custName+"</span> <button>待发货</button>",html+="</div>",html+='<div class="list-block media-list">',html+="<ul>",html=o(t,html),html+="</ul></div>",html+="</div></div>",html}function n(t){return html='<div class="content-block-1" groupId='+t.groupId+" orderId="+t.orderId+" orderStatus="+t.orderStatus+" cancelStatus="+t.cancelStatus+" orderType="+t.orderType+" sourceType="+t.sourceType+'><div class="order_box">',html+='<div class="order-address">',html+="<span>收货人: "+t.custName+"</span> <button>待成团</button>",html+="</div>",html+='<div class="list-block media-list">',html+="<ul>",html=o(t,html),html+="</ul></div>",html+='<div class="order-function">',html+='<button class="share_tour">分享拼团</button>',html+="</div>",html+="</div></div>",html}function l(t){return html='<div class="content-block-1" orderId='+t.orderId+" orderStatus="+t.orderStatus+" cancelStatus="+t.cancelStatus+" orderType="+t.orderType+" sourceType="+t.sourceType+'><div class="order_box">',html+='<div class="order-address">',html+="<span>收货人: "+t.custName+"</span> <button>已发货</button>",html+="</div>",html+='<div class="list-block media-list">',html+="<ul>",html=o(t,html),html+="</ul></div>",html+='<div class="order-function">',html+='<button class="order-zhui order-signin--1">确认签收</button>',html+='<button class="order-zhui order-signin--2">追踪物流</button>',html+="</div>",html+="</div></div>",html}function d(t){var e=t.orderDetailList[0].verifyStatus;return html='<div class="content-block-1" orderId='+t.orderId+" orderStatus="+t.orderStatus+" cancelStatus="+t.cancelStatus+" orderType="+t.orderType+" sourceType="+t.sourceType+'><div class="order_box">',html+='<div class="order-address">',"1"==e?html+="<span>收货人: "+t.custName+"</span> <button>待消费</button>":html+="<span>收货人: "+t.custName+"</span> <button>已消费</button>",html+="</div>",html+='<div class="list-block media-list">',html+="<ul>",html=o(t,html),html+="</ul></div>",html+='<div class="order-function">',"1"==e&&(html+='<button class="verifyCode">查看券码</button>'),html+="</div>",html+="</div></div>",html}function c(t){return html='<div class="content-block-1" orderId='+t.orderId+" orderStatus="+t.orderStatus+" cancelStatus="+t.cancelStatus+" orderType="+t.orderType+" sourceType="+t.sourceType+'><div class="order_box">',html+='<div class="order-address">',html+="<span>收货人: "+t.custName+"</span> <button>已完成</button>",html+="</div>",html+='<div class="list-block media-list">',html+="<ul>",html=o(t,html),html+="</ul></div>",html+="</div></div>",html}function i(t){return html='<div class="content-block-1"  orderId='+t.orderId+" orderStatus="+t.orderStatus+" cancelStatus="+t.cancelStatus+" orderType="+t.orderType+" sourceType="+t.sourceType+'><div class="order_box">',html+='<div class="order-address">',html+="<span>收货人: "+t.custName+"</span> <button>已关闭</button>",html+="</div>",html+='<div class="list-block media-list">',html+="<ul>",html=o(t,html),html+="</ul></div>",html+="</div></div>",html}function u(t){return html='<div class="content-block-1" orderId='+t.orderId+" orderStatus="+t.orderStatus+" cancelStatus="+t.cancelStatus+" orderType="+t.orderType+" sourceType="+t.sourceType+'><div class="order_box">',html+='<div class="order-address">',html+="<span>收货人: "+t.custName+"</span> <button>已退货</button>",html+="</div>",html+='<div class="list-block media-list">',html+="<ul>",html=o(t,html),html+="</ul></div>",html+="</div></div>",html}var h=getLocalSession("openid")||"",m=getLocalSession("custId")||"";return""==h||""==m?($.toast("未获取到用户资料，无法访问"),void xhq.gotoErrorPage()):($(document).on("pageInit","#page-ptr",function(e,r,o){$content=$(o).find(".content-block"),$(o).on("infinite",function(e){loading||(openIndicator(),loading=!0,setTimeout(function(){isAppendMode=1,t(),$.refreshScroller()},1e3))})}),$(".swiper-slide").on("tap",function(e){var r=$(this).attr("id"),o=0;r!=preTabId&&("all"==r?(orderStatus="",cancelStatus=""):"waitPay"==r?(orderStatus=1,cancelStatus=1):"waitDeliver"==r?(orderStatus=2,cancelStatus=1):"deliver"==r?(orderStatus=4,cancelStatus=1):"finish"==r?(orderStatus=5,cancelStatus=1):"close"==r?(orderStatus=6,cancelStatus=1):"refund"==r&&(orderStatus="",cancelStatus=3),o=1,$("#"+preTabId).removeClass("active"),$(this).addClass("active"),preTabId=r),1==o&&(openIndicator(),pageNo=0,t(),$.attachInfiniteScroll($content),$(".infinite-scroll-preloader").css("display","block"))}),$.init(),t(),openIndicator(),$("#tabContent").on("click",".verifyCode",function(){var t=$(this).parents(".content-block-1").attr("orderId");xhq.gotoUrl("../html/order_verify.html",{orderId:t})}),$("#tabContent").on("click",".share_tour",function(){var t=$(this).parents(".content-block-1").attr("groupId");xhq.gotoUrl("../html/tour_goods_share.html",{grouponId:t})}),$("#tabContent").on("click",".cancel-order",function(){var t=$(this).parents(".content-block-1").attr("orderId"),e=$(this);$.confirm("确定要取消订单吗？",function(){var r={interId:"toc.closeOrder",channel:"C",orderId:t,custId:m};xhq.__runXHQ(r,function(t){0==t.status?(""==orderStatus&&xhq.gotoUrl("../html/order_list.html"),e.parents(".content-block-1").remove()):$.toast(t.message)})})}),$("#tabContent").on("click",".pay",function(){var t=$(this).parents(".content-block-1").attr("orderId"),e=getLocalSession("custId")||"";if(""==e)return $.toast("未获取到用户资料，无法访问"),void xhq.gotoErrorPage();var r={interId:"toc.getPayCode",channel:"C",orderId:t,custId:e};xhq.__runXHQ(r,function(t){if(0==t.status){var e={};e.appId=t.body.weiData.appId,e.nonceStr=t.body.weiData.nonceStr.toString(),e["package"]=t.body.weiData.packageInfo,e.paySign=t.body.weiData.paySign,e.timeStamp=t.body.weiData.timeStamp+"";var r=t.body.orderNo,o=t.body.groupId||"",a=t.body.channelType,s=getLocalSession("mallType")||"";if(setLocalSession("localOrderSession",""),"gwcgm"==s){var n=getLocalSession("unCheckShoppingCartLocalSession");null==n&&void 0==n&&""==n||(n=""),setLocalSession("shoppingCartLocalSession",n)}xhq.wxPay(e,function(t){"4"==a?xhq.gotoUrl("../html/tour_successful.html",{orderNo:r,channelType:a,groupId:o}):xhq.gotoUrl("../html/paysuccess.html",{orderNo:r,channelType:a,groupId:o})},function(){xhq.gotoUrl("../html/order_list.html")})}else $.toast(t.message)})}),$("#tabContent").on("click",".order-signin--1",function(){var t=$(this).parents(".content-block-1").attr("orderId"),e=getLocalSession("custId")||"",o=$(this);$.confirm("您确定要签收吗?",function(){var a={interId:"toc.sureOrder",channel:"C",orderId:t,custId:e};xhq.__runXHQ(a,function(t){if(0==t.status){""==orderStatus&&xhq.gotoUrl("../html/order_list.html"),o.parents(".content-block-1").remove();var e=$("#tabContent").html();0==e.length&&$("#tabContent").html(r(e))}else $.toast(t.message)})})}),$("#tabContent").on("click",".order-signin--2",function(){var t=$(this).parents(".content-block-1").attr("orderId"),e=$(this).parents(".content-block-1").attr("orderStatus"),r=$(this).parents(".content-block-1").attr("cancelStatus"),o="order_detail.html";o="1"==e&&"1"==r?"order_wait_pay.html":"2"==e&&"1"==r?"order_wait_deliver.html":"4"==e&&"1"==r?"order_deliver.html":"5"==e&&"1"==r?"order_finish.html":"6"==e&&"1"==r?"order_close.html":"order_refund.html",xhq.gotoUrl(o,{orderId:t})}),void $("#tabContent").on("click",".list-block",function(){$(this).children("ul").css("background","rgb(217,217,217)");var t=$(this).parents(".content-block-1").attr("orderId"),e=$(this).parents(".content-block-1").attr("orderStatus"),r=$(this).parents(".content-block-1").attr("cancelStatus"),o=$(this).parents(".content-block-1").attr("orderType"),a=$(this).parents(".content-block-1").attr("sourceType"),s="order_detail.html";"1"==e&&"1"==r?s="order_wait_pay.html":"2"==e&&"1"==r&&"1"==o?s="order_wait_deliver.html":"2"==e&&"1"==r&&"0"==o?s="order_wait_group.html":"4"==e&&"1"==r?s="order_deliver.html":"5"==e&&"1"==r&&"0"==o?s="order_wait_group.html":"5"==e&&"1"==r&&5!=a&&"1"==o?s="order_finish.html":"5"==e&&"1"==r&&5==a&&"1"==o?s="order_verify.html":"6"==e?s="order_close.html":"3"==r&&(s="order_refund.html"),xhq.gotoUrl(s,{orderId:t,cancelStatus:r})}))});