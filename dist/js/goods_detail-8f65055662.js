function bindCustNumber(){var e=$.trim($("#newCustNumber").val());if(null==e||""==e)return void $.toast("身份证号码未录入");if(18!=e.length)return void $.toast("身份证号码长度不正确，请检查");$.showIndicator();var t={interId:"toc.updateCustNumberInfo",channel:"C",custId:custId,custNumber:e};xhq.__runXHQ(t,function(t){$.hideIndicator(),0==t.status?(setLocalSession("custNumber",e),2==gwc?(addToCart(),$(".bind_id").css("display","none"),$(".cover").css("display","none")):gotoBuyPub(channel)):$.toast(t.message)})}function bindPhone(){var e=$.trim($("#newPhoneNo").val()),t=$.trim($("#verficode").val());if(null==e||""==e)return void $.toast("手机号码未录入");if(11!=e.length)return void $.toast("手机号码长度不正确，请检查");if(null==t||""==t)return void $.toast("验证码未录入");if(4!=t.length)return void $.toast("验证码长度为4位，请检查");$.showIndicator();var a={interId:"toc.updateCustInfo",channel:"C",custId:custId,phoneNo:e,verificationCode:t};xhq.__runXHQ(a,function(t){$.hideIndicator(),0==t.status?(setLocalSession("phoneNo",e),gotoBuyPub(channel)):$.toast(t.message)})}function loadCartNum(){var e=getLocalSession("shoppingCartLocalSession");if(e&&e.search("{")!=-1){var t=JSON.parse(e);null!=t.body&&$(".cart .badge").html(t.body.length||0)}}function getDetail(e){if(oldOnlineId!=e){oldOnlineId=e,countConduct=0,$.showIndicator();var t={interId:"toc.getOnlineDetail",channel:"C",onlineId:e,isWs:xhq.getQuery("isWs")};xhq.__runXHQ(t,function(t){if($.hideIndicator(),0==t.status){setData(t.body);var a=2==getLocalSession("userType")?"&fromCustId="+custId+"&fromUserType=2":"";shareTitle=t.body.showName||"全民集市精品分享",shareIcon=t.body.bigPic,shareUrl=xhq.getDomainUrl()+"share_goods_detail.html?onlineId="+e+a+"&"+xhq.getVersion(),shareConfig={title:shareTitle,desc:"我在全民集市发现了一个不错的商品，快来看看吧。",link:shareUrl,imgUrl:shareIcon},xhq.initWXJsConfig()}else $.toast(t.message)})}}function setData(e){var t=e.needVerify||0;globalNeedVerify=t,topTypeName=e.topTypeName,globalStatus=e.status,channel=e.channel,description=editHTML(e.description),$(".text_goods").html(description),specDescription=editHTML(e.specDescription),$(".parameter").html(specDescription),maintainDesction=editHTML(e.maintainDesction),$(".to_know").html(maintainDesction),$(".test-lazyload").picLazyLoad({threshold:100});var a=e.ggs;if(a&&a.length){var s="";for(var n in a){var o=oldOnlineId==a[n].online_id?"spec_list active":"spec_list";s+='<span class="'+o+'" id='+a[n].online_id+">"+a[n].ggValue+"</span> "}$(".spec_item").html(s)}if($(".spec_item").on("tap",".spec_list",function(){$(this).attr("id")!=oldOnlineId&&($("#"+oldOnlineId).removeClass("active"),$(this).addClass("active"),getDetail($(this).attr("id")))}),e.images&&""!=e.images){var i=e.images.split(",");if(i.length){var d='<div class="swiper-wrapper">';for(var n in i)d+='<div class="swiper-slide"><img src="'+i[n].trim()+'" alt=""></div>';if(d+='</div><div class="swiper-pagination"></div>',$(".swiper-container").html(d),i.length>1){new Swiper(".swiper-container",{pagination:".swiper-pagination",paginationClickable:!0,spaceBetween:30,centeredSlides:!0,autoplay:2500,autoplayDisableOnInteraction:!1})}}}setGoodsBrief(e),setFoot(e),initCartJson(e),initOrderJson(e)}function initCartJson(e){cartJson={showName:e.showName,money:e.money,salePrice:e.salePrice,onlineId:e.onlineId,bigPic:e.bigPic,goodId:e.skuId,mailMoney:e.mailMoney,purchasePrice:e.purchasePrice,num:0}}function initOrderJson(e){orderJson={showName:e.showName,mailMoney:e.mailMoney,salePrice:e.salePrice,onlineId:e.onlineId,bigPic:e.bigPic,goodId:e.skuId,purchasePrice:e.purchasePrice,num:0}}function setGoodsBrief(e){var t=(e.purchasePrice||0)/100,a=0==parseInt(t)||""==t?"":'<span class="price_two">&yen;'+t+"</span>",s=""==(e.endTime||"")?"":'<span class="end_time"><span>'+e.endTime+"</span>结束</span>",n=""==(e.startTime||"")?"":'<span class="end_time"><span>'+e.startTime+"</span>开始抢购<span>";if(1==xhq.getQuery("isWs")){$("#brief1").css("display","none"),$("#brief2").css("display","block");var o='<div class="brief_title">'+e.showName+"</div>";o+='<div class="brief_price"><p class="p_l"><span class="price_one">特卖价</span><span class="span_m">&yen;'+(e.salePrice||0)/100+'</span class="price_two">'+a+'<br><span class="price_three">赚：<span class="bonus">&yen;'+(e.bonus||0)/100+'</span></span></p><p class="p_r"><span>'+(e.salesNum||0)+"</span>人在卖<br>"+s+n+"</p></div>",$("#brief2").html(o)}else{$("#brief1").css("display","block"),$("#brief2").css("display","none");var o='<div class="brief_title">'+e.showName+"</div>";o+='<div class="brief_price"><p class="p_l"><span class="price_one">特卖价</span><span class="span_m">&yen;'+(e.salePrice||0)/100+'</span class="price_two">'+a+'<br><span class="price_three">送积分：<span class="bonus">'+(e.money||0)+'</span></span></p><p class="p_r"><span>'+(e.salesNum||0)+"</span>人在卖<br>"+s+n+"</p></div>",$("#brief1").html(o)}1==e.status?$(".goods_state").children("img").attr("src","../img/jinxingzhong.png"):2==e.status?$(".goods_state").children("img").attr("src","../img/yishouwan.png"):3==e.status?$(".goods_state").children("img").attr("src","../img/weikaishi.png"):4==e.status&&$(".goods_state").children("img").attr("src","../img/yijieshu.png")}function hideFoot(){1==footMode?$("#addCart").hide():$("#addCart2").hide()}function showFoot(){1==footMode?$("#addCart").show():$("#addCart2").show()}function setFootDisable(e){$(".subtract").attr("disabled","disabled"),$(".add").attr("disabled","disabled"),1==e&&($(".cart").attr("disabled","disabled"),$(".add_cart").attr("disabled","disabled"),$(".badge").css("background","rgb(156,156,156)"),$(".add_cart").css("background","rgb(180,180,180)")),$(".buy_now").attr("disabled","disabled"),$(".buy_now").css("background","rgb(156,156,156)")}function setFootAble(e){2==e?($(".subtract").attr("disabled","disabled"),$(".add").attr("disabled","disabled")):($(".subtract").attr("disabled",null),$(".add").attr("disabled",null),$(".cart").attr("disabled",null),$(".add_cart").attr("disabled",null),$(".badge").css("background","rgb(222,63,55)"),$(".add_cart").css("background","rgb(249,174,57)")),$(".buy_now").attr("disabled",null),$(".buy_now").css("background","rgb(222,63,55)")}function setFoot(e){2==e.channel||1==e.channel&&e.needVerify?(footMode=2,$("#addCart2").show(),$("#addCart").hide(),1==e.status?setFootAble(2):setFootDisable(2)):(footMode=1,$("#addCart").show(),$("#addCart2").hide(),1==e.status?setFootAble(1):setFootDisable(1))}function getConduct(e){if(!countConduct){$.showIndicator();var t={interId:"toc.getOnlineConduct",channel:"C",onlineId:e};xhq.__runXHQ(t,function(e){$.hideIndicator(),0==e.status?(countConduct++,addConductElement(e.body)):$.toast(e.message)})}}function addConductElement(e){if(e&&e.length>0){if(e[0].images){var t="",a=e[0].images.split(",");if(a.length)for(var s in a)t+='<div class="pic_item"><img src="'+a[s].trim()+'" alt=""></div>';$(".document_pic").html(t)}$(".document_span").html(e[0].conduct)}}function addToCart(){var e=$(".num_handle").val();e=parseInt(e),cartJson.num=e;var t=addCartPub(cartJson);$(".cart .badge").html(t||0)}var openId,custId,oldOnlineId,channel,footMode,countConduct,cartJson,orderJson,globalNeedVerify=0,topTypeName="",globalStatus=1,gwc=1;$(function(){if(openId=getLocalSession("openid")||"",custId=getLocalSession("custId")||"",""==openId||""==custId)return void xhq.gotoErrorPage();var e=xhq.getQuery("onlineId");getDetail(e),loadCartNum(),$("#goods_detail_tab").on("tap",function(){showFoot()}),$("#goods_document_tab").on("tap",function(){hideFoot(),getConduct(oldOnlineId)}),$(".add").on("tap",function(){if(!$(this).attr("disabled")){var e=$(".num_handle");e.val(parseInt(e.val())+1)}}),$(".subtract").on("tap",function(){if(!$(this).attr("disabled")){var e=$(".num_handle");e.val(parseInt(e.val())-1),parseInt(e.val())<1&&e.val(1)}}),$(".add_cart").on("tap",function(){if(!$(this).attr("disabled")){var e=getLocalSession("custNumber")||"";return null!=e&&void 0!=e&&""!=e||"网咖"!=topTypeName||1!=globalStatus?void addToCart():($(".bind_id").css("display","block"),$(".cover").css("display","block"),void(gwc=2))}}),$(".buy_now").on("tap",function(){if(gwc=1,!$(this).attr("disabled")){orderJson.num=$(".num_handle").val(),refreshOrderCache(orderJson);var e=getLocalSession("phoneNo"),t=getLocalSession("custNumber"),a=new RegExp("^(13[0-9]|15[012356789]|17[0135678]|18[0-9]|14[57])[0-9]{8}$","ig");null!=e&&void 0!=e&&a.test(e.trim())||!globalNeedVerify||1!=globalStatus?null!=t&&void 0!=t&&""!=t||"网咖"!=topTypeName||1!=globalStatus?gotoBuyPub(channel):($(".bind_id").css("display","block"),$(".cover").css("display","block")):($(".bind_phone").css("display","block"),$(".cover").css("display","block"))}}),$(".bind_cancle").on("tap",function(){"网咖"==topTypeName?($(".bind_id").css("display","none"),$(".cover").css("display","none")):($(".bind_phone").css("display","none"),$(".cover").css("display","none"))}),$(".bind_comfir").on("tap",function(){"网咖"==topTypeName?bindCustNumber():bindPhone()}),$("#btnGetCode").on("tap",function(e){var t=$.trim($("#newPhoneNo").val());xhq.tobGetVerificationCode($(this),t,function(){$.toast("验证码已发送")})}),$(".cart").on("tap",function(){$(this).attr("disabled")||xhq.gotoUrl("shoppingcart.html",{})}),$(".copy_document").on("tap",function(){$(".document_span").addClass("active")}),wx.ready(function(){wx.onMenuShareAppMessage(shareConfig),wx.onMenuShareTimeline(shareConfig)}),$("#tohome1").on("tap",function(){2==xhq.getQuery("fromUserType")?xhq.gotoUrl("home.html"):1==xhq.getQuery("isWs")?xhq.gotoUrl("ws_home.html"):xhq.gotoUrl("home.html")}),$("#tohome2").on("tap",function(){2==xhq.getQuery("fromUserType")?xhq.gotoUrl("home.html"):1==xhq.getQuery("isWs")?xhq.gotoUrl("ws_home.html"):xhq.gotoUrl("home.html")})});