function openIndicator(){$.showIndicator(),isIndicator=!0}function hideIndicator(){isIndicator&&($.hideIndicator(),isIndicator=!1),loading=!1}function showNoDataPage(){$("#content-block1").hide(),$("#content-block2").show()}var pageNo=0,pageSize=10,$content=null,loading=!1,fromCustId=0;$(function(){function s(){pageNo+=1;var s={interId:"toc.custOnlineList",channel:"C",fromCustId:fromCustId,pageNo:pageNo,pageSize:pageSize};xhq.__runXHQ(s,function(s){hideIndicator(),0==s.status?(a(s),(!s.body||!s.body.datas||s.body.datas.length<pageSize)&&($.detachInfiniteScroll($content),$(".infinite-scroll-preloader").remove()),1!=pageNo||null!=!s.body&&s.body.datas&&s.body.datas.length||showNoDataPage(),loading=!1):$.toast(s.message)})}function a(s){$("#input_image").attr("src",s.body.headimgUrl||DEFAULT_HEADIMG),$("#input_level").html(s.body.level||"店长"),$("#input_sname").html((s.body.nickName||"")+"的店铺");var a="";if(s.body&&s.body.datas&&s.body.datas.length>0){for(var o=0;o<s.body.datas.length;o++){var l=s.body.datas[o];a+=1==l.status?n(l):2==l.status||4==l.status?i(l):t(l)}$(".content-block .list_container").append(a)}}function n(s){var a='<li><a href="goods_detail.html?onlineId='+s.onlineId+"&"+xhq.getVersion()+'" class="item-link list-button external"><div class="li_l"><img src='+s.ImageUrl+' alt=""></div><div class="li_r"><div class="up_con">'+s.showName+'</div><div class="mid_con"><div class="pri_l">';if(a+=s.purchasePrice?'<p>¥<span class="pri_one">'+s.salePrice/100+'</span><s>¥<span class="pri_two">'+s.purchasePrice/100+"</span></s></p>":'<p>¥<span class="pri_one">'+s.salePrice/100+'</span><s><span class="pri_two"></span></s></p>',a+='</div><div class="pri_r">送积分:<span>'+s.money+'</span></div></div><div class="down_con"><div class="sur_l">',s.stock<=0)a+='<p class="surplus"><span class="span_f"></span><span class="span_s">剩余<span>0</span>个</span></p></div>';else{var n=o(s.totalStock,s.stock);a+=1==n?'<p class="surplus" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'"><span class="span_f" style="width:4.5rem;border-radius: 8px"></span>':n>.9&&n<1?'<p class="surplus" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'"><span class="span_f" style="width:4.05rem;border-radius: 8px 0 0 8px"></span>':'<p class="surplus" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'"><span class="span_f" style="width:'+4.5*n+'rem;border-radius: 8px 0 0 8px" ></span>',a+='<span class="span_s">剩余<span>'+s.stock+"</span>个</span></p></div>"}return a+='<div class="sur_a">立即抢<img src="../img/icoJiantou1.png"></div></div></div></a></li>'}function i(s){var a='<li class="over"><a href="goods_detail.html?onlineId='+s.onlineId+"&"+xhq.getVersion()+'" class="item-link list-button external"><div class="li_l"><img src='+s.ImageUrl+' alt=""></div><div class="li_r"><div class="up_con">'+s.showName+'</div><div class="mid_con"><div class="pri_l">';return a+=s.purchasePrice?'<p>¥<span class="pri_one">'+s.salePrice/100+'</span><s>¥<span class="pri_two">'+s.purchasePrice/100+"</span></s></p>":'<p>¥<span class="pri_one">'+s.salePrice/100+'</span><s><span class="pri_two"></span></s></p>',a+='</div><div class="pri_r">送积分:<span>'+s.money+'</span></div></div><div class="down_con"><div class="sur_l"><p class="surplus"><span class="span_f"></span><span class="span_s">剩余<span>0</span>个</span></p ></div><div class="sur_a">已抢完<img src="../img/icoJiantou1.png"></div></div></div></a></li>'}function t(s){var a='<li class="waiting"><a href="goods_detail.html?onlineId='+s.onlineId+"&"+xhq.getVersion()+'" class="item-link list-button external"><div class="li_l"><img src='+s.ImageUrl+' alt=""></div><div class="li_r"><div class="up_con">'+s.showName+'</div><div class="mid_con"><div class="pri_l">';return a+=s.purchasePrice?'<p>¥<span class="pri_one">'+s.salePrice/100+'</span><s>¥<span class="pri_two">'+s.purchasePrice/100+"</span></s></p>":'<p>¥<span class="pri_one">'+s.salePrice/100+'</span><s><span class="pri_two"></span></s></p>',a+='</div><div class="pri_r">送积分:<span>'+s.money+'</span></div></div><div class="down_con"><div class="sur_l"><p class="surplus"><span class="span_f"></span><span class="span_s">剩余<span>'+s.stock+'</span>个</span></p ></div><div class="sur_a">未开始<img src="../img/icoJiantou1.png"></div></div></div></a></li>'}function o(s,a){return 0==s?1:a/s}fromCustId=xhq.getQuery("fromCustId"),$(document).on("pageInit","#page-ptr",function(a,n,i){$content=$(i).find(".content-block"),$(i).on("infinite",function(a){loading||(openIndicator(),loading=!0,setTimeout(function(){isAppendMode=1,s(),$.refreshScroller()},1e3))})}),$.init(),openIndicator(),s(),$("#tome").on("tap",function(){2==getLocalSession("userType")?xhq.gotoUrl("ws_me.html"):xhq.gotoUrl("me.html")}),$("#totour").on("tap",function(){xhq.gotoUrl("tour.html")}),$("#totype").on("tap",function(){xhq.gotoUrl("goodtypes.html")}),$("#tohome").on("tap",function(){xhq.gotoUrl("home.html")})});