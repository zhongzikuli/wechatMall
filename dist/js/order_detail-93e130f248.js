function openIndicator(){$.showIndicator(),isIndicator=!0}function hideIndicator(){isIndicator&&($.hideIndicator(),isIndicator=!1),loading=!1}$(document).ready(function(){function e(){var e={interId:"toc.getAvoidExpressFee",channel:"C"};xhq.__runXHQ(e,function(e){if(0==e.status){var t=e.body.unpayDelay;$("#waitPayTitle").html("未支付订单将在"+t+"分钟之后关闭，请尽快完成支付")}else hideIndicator(),$.toast(e.message)})}function t(e,t){for(var a=0;a<e.length;a++){var r=e[a],s=r.details.split("|");t+='<div class="content-block4">',t+='<div class="package">',t+=null!=r.expressNo&&void 0!=r.expressNo&&""!=r.expressNo&&"自提"!=r.expressNo?"<span>包裹"+(a+1)+'</span><button type="button" expressNo='+r.expressNo+" expressType="+r.expressType+">追踪物流</button>":"<span>包裹"+(a+1)+"</span>",t+="</div>",t+="<hr>",t+='<div class="package-product">',t+='<div class="package-product-number">',t+=null!=r.expressNo&&void 0!=r.expressNo&&""!=r.expressNo?"运单编号："+r.expressNo:"运单编号：",t+="</div>",t+='<div class="package-product-name">';for(var n=0;n<s.length;n++)t+="<p>商品"+o(n+1)+"："+s[n]+" </p>";t+="</div>",t+=" </div></div>"}return t}function o(e){for(var t=e.toString(),o=e.toString().length,a=[],r=0;r<o;r++)a.push(i[t.charAt(r)]);return a.join("")}var a=getLocalSession("openid")||"",r=getLocalSession("custId")||"";if(""==a||""==r)return $.toast("未获取到用户资料，无法访问"),void xhq.gotoErrorPage();openIndicator();var s=xhq.getQuery("orderId")||"",n=xhq.getQuery("cancelStatus")||"",d={interId:"toc.getDistinctExpreeNoOrderDetail",channel:"C",orderId:s,cancelStatus:n};xhq.__runXHQ(d,function(o){if(0==o.status){if(o.body){var a=o.body.order[0];$(".addressName").html(a.addressName||""),$(".address-pnone").html(a.addressPhone||""),$(".address-attr").html(a.province+a.city+a.country+a.detailAddress),4==a.payWay?($("#payWayContent").html("积分"),$("#originalPrice").html(a.realPay+a.deductionPrice),$("#realPay").html(a.realPay+(a.expressFee||0)+a.deductionPrice),$("#expressFee").html(a.expressFee||0)):($("#payWayContent").html("微信"),$("#originalPrice").html("¥"+a.realPay/100),$("#realPay").html("¥"+(a.realPay+(a.expressFee||0))/100),$("#expressFee").html("¥"+(a.expressFee||0)/100),$("#deductionPrice").html("¥"+(a.deductionPrice||0)/100)),$("#orderId").val(a.orderId),$(".show-time").html(a.createTime+"<br>"+a.orderNo);var r="";"1"==a.orderStatus?(4==a.payWay?$("#waitRealPay").html(a.realPay):$("#waitRealPay").html("¥"+a.realPay/100),e()):"2"==a.orderStatus&&"1"==a.orderType?4==a.payWay?$("#sumTotalRefund").html(a.sumTotalRefund):$("#sumTotalRefund").html("¥"+a.sumTotalRefund/100):"2"==a.orderStatus&&"0"==a.orderType?$("#sumTotalRefund").html("¥"+a.sumTotalRefund/100):"4"==a.orderStatus&&"1"==a.cancelStatus?(4==a.payWay?$("#sumTotalRefund").html(a.sumTotalRefund):$("#sumTotalRefund").html("¥"+a.sumTotalRefund/100),$("#expressContent").html(t(o.body.orderDetailListRows,r))):"5"==a.orderStatus&&"1"==a.cancelStatus?(4==a.payWay?$("#sumTotalRefund").html(a.sumTotalRefund):$("#sumTotalRefund").html("¥"+a.sumTotalRefund/100),$("#expressContent").html(t(o.body.orderDetailListRows,r))):"3"==a.cancelStatus&&$("#sumTotalRefund").html("¥"+a.sumTotalRefund/100)}hideIndicator()}else $.toast(o.message),hideIndicator()}),$("#mailList").on("click",".cancel-order",function(){var e=$("#orderId").val(),t=getLocalSession("custId")||"";$.confirm("确定要取消订单吗？",function(){var o={interId:"toc.closeOrder",channel:"C",orderId:e,custId:t};xhq.__runXHQ(o,function(t){0==t.status?xhq.gotoUrl("order_close.html",{orderId:e}):$.toast(t.message)})})}),$("#mailList").on("click",".pay",function(){var e=$("#orderId").val(),t=getLocalSession("custId")||"";if(""==t)return $.toast("未获取到用户资料，无法访问"),void xhq.gotoErrorPage();var o={interId:"toc.getPayCode",channel:"C",orderId:e,custId:t};xhq.__runXHQ(o,function(e){if(0==e.status){var t={};t.appId=e.body.weiData.appId,t.nonceStr=e.body.weiData.nonceStr.toString(),t["package"]=e.body.weiData.packageInfo,t.paySign=e.body.weiData.paySign,t.timeStamp=e.body.weiData.timeStamp+"";var o=e.body.orderNo,a=e.body.groupId||"",r=e.body.channelType,s=getLocalSession("mallType")||"";if(setLocalSession("localOrderSession",""),"gwcgm"==s){var n=getLocalSession("unCheckShoppingCartLocalSession");null==n&&void 0==n&&""==n||(n=""),setLocalSession("shoppingCartLocalSession",n)}xhq.wxPay(t,function(e){"4"==r?xhq.gotoUrl("../html/tour_successful.html",{orderNo:o,channelType:r,groupId:a}):xhq.gotoUrl("../html/paysuccess.html",{orderNo:o,channelType:r,groupId:a})},function(){xhq.gotoUrl("../html/order_list.html")})}else $.toast(e.message)})}),$("#expressContent").on("click","button",function(){var e=$(this).attr("expressNo"),t=($(this).attr("expressType"),"http://m.kuaidi100.com/index_all.html?postid="+e);xhq.gotoUrl(t)});var i=["零","一","二","三","四","五","六","七","八","九"]});