function openIndicator(){$.showIndicator(),isIndicator=!0}function hideIndicator(){isIndicator&&($.hideIndicator(),isIndicator=!1),loading=!1}function shoppingCart_advertHtml(){var i={interId:"toc.getAvoidExpressFee",channel:"C"};xhq.__runXHQ(i,function(i){0==i.status?($("#avoidExpressFee").val(i.body.avoidExpressFee),setLocalSession("avoidExpressFee",i.body.avoidExpressFee),setLocalSession("expressFee",i.body.expressFee),setLocalSession("deliverSureDay",i.body.deliverSureDay),setLocalSession("cancelDelday",i.body.cancelDelday),0==i.body.avoidExpressFee?$("#shoppingWarn").html(i.body.cancelDelday+"天无忧退货  全场包邮"):$("#shoppingWarn").html(i.body.cancelDelday+"天无忧退货  满"+i.body.avoidExpressFee/100+"元免邮  全程正品保障")):(hideIndicator(),$.toast(i.message))})}function shoppingCartHtml(i,t,e){var i='<div class="list1" onlineId='+t.onlineId+" mailMoney="+t.mailMoney+" goodId="+t.goodId+">";return i+='<div class="list1-radio"><img src="../img/icoWeixuanze@2x.png" alt=""></div>',i+='<div class="list1-img"><img src="'+t.bigPic+'" alt=""></div>',i+='<div class="list1-wenzi">',i+="<p>"+t.showName+"</p>",i+='<span class="bargain-price price" salePrice='+t.salePrice+">"+t.salePrice/100+"</span>",i+=t.purchasePrice>0?'<span class="bar1 price" purchasePrice='+t.purchasePrice+">"+t.purchasePrice/100+"</span>":"<span purchasePrice="+t.purchasePrice+"></span>",i+='<p class="num_box shangjia">',i+='<span class="span1 cutdown subtract">-</span>',i+='<span num="'+e.num+'" class="num_handle num">'+e.num+"</span>",i+='<span class="span1 add">+</span>',i+="</p>",i+="</div>",i+="</div>"}function timeOutCart(i,t){var i='<div class="list1" onlineId='+t.onlineId+" mailMoney="+t.mailMoney+" goodId="+t.goodId+">";return i+='<div class="list1-radio"><img src="../img/icoWeixuanze@2x.png" alt=""></div>',i+='<div class="list1-img"><img src="'+t.bigPic+'" alt=""></div>',i+='<div class="list1-wenzi">',i+="<p>"+t.showName+"</p>",i+='<span class="bargain-price price" salePrice='+t.salePrice+">"+t.salePrice/100+"</span>",i+='<p class="shixiao">失效</p>',i+="</div>",i+="</div>"}function nullCartHtml(){var i='<div style="width:100vw;height:100vh;background-color:white;"><div class="kongde">';i+="<div>",i+='<img id="cart1" src="../img/group2@2x.png" alt="">',i+="</div>",i+='<p style="margin-top:0rem;">购物车空空的 <br> 快去挑几件好货吧</p>',i+=2==xhq.getQuery("fromUserType")?'<p style="margin-top: 1.2rem;"><span onclick="window.location.href=\'home.html?'+xhq.getVersion()+"'\">返回首页</span></p>":1==xhq.getQuery("isWs")?'<p style="margin-top: 1.2rem;"><span onclick="window.location.href=\'ws_home.html?'+xhq.getVersion()+"'\">返回首页</span></p>":'<p style="margin-top: 1.2rem;"><span onclick="window.location.href=\'home.html?'+xhq.getVersion()+"'\">返回首页</span></p>",i+="</div></div>",$("footer").css("display","none"),$("#mailList").append(i)}function bianlishuju(){for(var i={},t=[],e=[],n=0;n<$(".list1").length;n++)if("../img/ico_xuanze.png"==$(".list1").eq(n).find(".list1-radio img").attr("src")){var s={};s.onlineId=$(".list1").eq(n).attr("onlineId"),s.mailMoney=""==$(".list1").eq(n).attr("mailMoney")?0:$(".list1").eq(n).attr("mailMoney"),s.goodId=$(".list1").eq(n).attr("goodId"),s.bigPic=$(".list1").eq(n).find(".list1-img img").attr("src"),s.showName=$(".list1").eq(n).find(".list1-wenzi p").eq(0).text(),s.salePrice=$(".list1").eq(n).find(".list1-wenzi .bargain-price").attr("salePrice"),s.purchasePrice=$(".list1").eq(n).find(".list1-wenzi .bar1").attr("purchasePrice"),s.num=$(".list1").eq(n).find(".list1-wenzi .num").text(),t.push(s);var a=$(".list1").eq(n).find(".list1-wenzi .shixiao").text()||"";if(""!=a)var r=1}else{var o={};o.onlineId=$(".list1").eq(n).attr("onlineId"),o.mailMoney=$(".list1").eq(n).attr("mailMoney"),o.goodId=$(".list1").eq(n).attr("goodId"),o.bigPic=$(".list1").eq(n).find(".list1-img img").attr("src"),o.showName=$(".list1").eq(n).find(".list1-wenzi p").eq(0).text(),o.salePrice=$(".list1").eq(n).find(".list1-wenzi .bargain-price").attr("salePrice"),o.purchasePrice=""==$(".list1").eq(n).find(".list1-wenzi .bar1").attr("purchasePrice")?0:$(".list1").eq(n).find(".list1-wenzi .bar1").attr("purchasePrice"),o.num=$(".list1").eq(n).find(".list1-wenzi .num").text(),e.push(o)}return i.arr=t,i.arr1=e,i.xiadan=r,i}function shoopcart_event(){function i(i,t){for(var e,n=JSON.parse(getLocalSession("shoppingCartLocalSession")),s=0;s<n.body.length;s++)if(n.body[s].onlineId==i){if(e=n.body[s],1==t){e.num=e.num+1;break}if(2==t){e.num=e.num-1;break}if(3==t){n.body.splice(s,1),0==n.body.length&&nullCartHtml();break}}setLocalSession("shoppingCartLocalSession",JSON.stringify(n))}$(".list1").each(function(){$(this).find(".list1-wenzi p .cutdown").click(function(){if("../img/ico_xuanze.png"==$(this).parents(".list1").find(".list1-radio img").attr("src")&&parseFloat($(this).parents("p").find(".num").attr("num"))>1){var t=100*$(this).parents(".list1-wenzi").find(".bargain-price").text();$("footer p span").eq(2).text(function(){var i=100*$("footer p span").eq(2).text()-t;return parseFloat(i/100).toFixed(2)})}var e=$(this).parents("p").find(".num");e.text(function(){if(parseInt(e.attr("num"))>1){var t=$(this).parents(".list1").attr("onlineId");return i(t,2),parseInt(e.text())-1}return 1}).attr("num",function(){return parseFloat(e.attr("num"))>1?(parseFloat(e.attr("num"))-1).toString():1})})});var t=0;$(".list1").each(function(){$(this).find(".list1-wenzi p").eq(1).find(".add").click(function(){var t=$(this).parents("p").find(".num");t.text(parseInt(t.text())+1),t.attr("num",function(){return(parseFloat(t.attr("num"))+1).toString()});var e=$(this).parents(".list1").attr("onlineId");if(i(e,1),"../img/ico_xuanze.png"==$(this).parents(".list1").find(".list1-radio img").attr("src")){var n=100*$(this).parents(".list1").find(".list1-wenzi span").eq(0).text();$("footer p span").eq(2).text(function(){var i=100*parseFloat($("footer p span").eq(2).text())+n;return parseFloat(i/100).toFixed(2)})}})});var e=0;$(".list1").each(function(){$(this).find(".list1-radio").click(function(){if("../img/ico_xuanze.png"==$(this).find("img").attr("src")){if(e--,$(this).find("img").attr("src","../img/icoWeixuanze@2x.png"),""==$(this).parents(".list1").find(".list1-wenzi p").eq(1).find(".num").text()||null==$(this).parents(".list1").find(".list1-wenzi p").eq(1).find(".num").text())var i=0;else var i=parseFloat($(this).parents(".list1").find(".list1-wenzi span").eq(0).text())*parseFloat($(this).parents(".list1").find(".list1-wenzi p").eq(1).find(".num").text())*100;$("footer p span").eq(2).text(function(){var t=(100*parseFloat($("footer p span").eq(2).text())-i)/100;return t.toFixed(2).toString()})}else{if(e++,$(this).find("img").attr("src","../img/ico_xuanze.png"),"number"==typeof parseFloat($(this).parents(".list1").find(".list1-wenzi p").eq(1).find(".num").text()))if(""==parseFloat($(this).parents(".list1").find(".list1-wenzi p").eq(1).find(".num").text())||null==$(this).parents(".list1").find(".list1-wenzi p").eq(1).find(".num").text())var n=0;else var n=parseFloat($(this).parents(".list1").find(".list1-wenzi .bargain-price").text())*parseInt($(this).parents(".list1").find(".list1-wenzi .num").text())*100;$("footer p span").eq(2).text(function(){var i=(n+100*parseFloat($("footer p span").eq(2).text()))/100;return i.toFixed(2).toString()})}$(".list1").length==e?($("footer .click1 img").attr("src","../img/ico_xuanze.png"),t++):($("footer .click1 img").attr("src","../img/icoWeixuanze@2x.png"),t++)})}),$("footer .click1").click(function(){t++,t%2==0?($(".list1 .list1-radio img").attr("src","../img/icoWeixuanze@2x.png"),$("footer .click1 img").attr("src","../img/icoWeixuanze@2x.png"),$("footer p span").eq(2).text("0.00")):($(".list1 .list1-radio img").attr("src","../img/ico_xuanze.png"),$("footer .click1 img").attr("src","../img/ico_xuanze.png"),$("footer p span").eq(2).text("0"),$(".list1").each(function(){if("number"==typeof parseFloat($(this).find(".list1-wenzi  .num").text()))if(""==$(this).find(".list1-wenzi  .num").text()||null==$(this).find(".list1-wenzi  .num").text())var i=0;else var i=parseFloat($(this).find(".list1-wenzi .bargain-price").text())*parseFloat($(this).find(".list1-wenzi .num").text())*100;else var i=parseFloat($(this).find(".list1-wenzi span").eq(0).text());$("footer p span").eq(2).text(function(){return((i+100*parseFloat($("footer p span").eq(2).text()))/100).toFixed(2).toString()})}))}),$("#shanchu").click(function(){var n=bianlishuju();return 0==n.arr.length?void $.toast("请选择删除商品"):void $.confirm("您确定要删除吗?",function(){$(".list1").each(function(){if("../img/ico_xuanze.png"==$(this).find(".list1-radio img").attr("src")){$(this).remove($(this).find(".list1-radio img")[src="../img/ico_xuanze.png"]),$("footer p span").eq(2).text("0.00");var t=$(this).attr("onlineId");i(t,3)}}),t%2==1&&(t++,$("footer .click1 img").attr("src","../img/icoWeixuanze@2x.png"));bianlishuju();e=0})}),$(".xia").click(function(){var i=bianlishuju();if(1==i.xiadan)$.toast("选中了不能下单的商品");else if(0==i.arr.length)$.toast("请选择商品");else{if(setLocalSession("localOrderSession",JSON.stringify(i.arr)),null!=i.arr1&&i.arr1.length>0){var t={};t.body=i.arr1,setLocalSession("unCheckShoppingCartLocalSession",JSON.stringify(t))}else setLocalSession("unCheckShoppingCartLocalSession","");xhq.gotoUrl("../html/order.html",{mallType:"gwcgm",sourceType:"3",channelType:"1"})}}),$(".content-block .content-block1 img").click(function(){$(".content-block1").hide()})}var shopingCartSession=getLocalSession("shoppingCartLocalSession");$(document).ready(function(){var i=getLocalSession("openid")||"";if(""==i)return $.toast("未获取到用户资料，无法访问"),void xhq.gotoErrorPage();openIndicator();var t=$("#mailList").html();if(null==shopingCartSession||void 0==shopingCartSession||""==shopingCartSession)return nullCartHtml(),shoppingCart_advertHtml(),void hideIndicator();if(shopingCartSession=JSON.parse(shopingCartSession),null==shopingCartSession.body||0==shopingCartSession.body.length)return nullCartHtml(),shoppingCart_advertHtml(),void hideIndicator();for(var e="",n=0;n<shopingCartSession.body.length;n++){var s=shopingCartSession.body[n];n<shopingCartSession.body.length-1?e=e+s.onlineId+",":e+=s.onlineId}var a={interId:"toc.getCheckGoodsIsOnline",channel:"C",onlineIds:e};xhq.__runXHQ(a,function(i){if(0==i.status){for(var e="",n="",s=shopingCartSession.body.length-1;s>=0;s--){var a,r=!1,o=shopingCartSession.body[s];if(null!=i.body&&i.body.length>0)for(var l=0;l<i.body.length;l++)if(a=i.body[l],o.onlineId==a.onlineId){r=!0;break}r?e+=shoppingCartHtml(t,a,o):n+=timeOutCart(t,o)}$("#mailList").append(e),$("#mailList").append(n),shoppingCart_advertHtml(),shoopcart_event(),hideIndicator()}else hideIndicator(),$.toast(i.message)})});