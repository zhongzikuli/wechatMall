function getTommow(){var s=new Date;return s.setDate(s.getDate()+1),s.getFullYear()+"-"+(s.getMonth()+1<10?"0":"")+(s.getMonth()+1)+"-"+((s.getDate()<10?"0":"")+s.getDate())}function openIndicator(){$.showIndicator(),isIndicator=!0}function hideIndicator(){isIndicator&&($.hideIndicator(),isIndicator=!1),loading=!1}function shareHome(){shareConfig={title:"全名集市",desc:"全名集市",link:"http://t.cn/RxAuWCM",imgUrl:"http://qmjs.xiaohongquan.cn/dist/img/icon_logo.png"},xhq.initWXJsConfig()}var pageNo=0,pageSize=20,curdate=xhq.getToday(),isIndicator=!1,isAppendMode=1,$content=null,loading=!1,curtab=1,shareConfig={};$(function(){function s(){pageNo+=1;var s={interId:"toc.getGoodsOnline",channel:"C",date:curdate,sortType:1,filter:1,pageNo:pageNo,pageSize:pageSize,orgId:xhq.getQuery("orgId")};xhq.__runXHQ(s,function(s){0==s.status?(n(s),(null==s.body||s.body.length<pageSize)&&($.detachInfiniteScroll($content),$(".infinite-scroll-preloader").remove()),loading=!1):(hideIndicator(),$.toast(s.message)),hideIndicator()})}function n(s){var n="";if(0==isAppendMode&&($(".content-block .list_container").html(""),isAppendMode=1),null!=s.body&&s.body.length>0){for(var e=0;e<s.body.length;e++){var o=s.body[e];1==o.status?n+=a(o):2==o.status||4==o.status?n+=i(o):3==o.status&&(n+=t(o))}$(".content-block .list_container").append(n)}}function a(s){var n='<li><a href="goods_detail.html?onlineId='+s.onlineId+"&"+xhq.getVersion()+'" class="item-link list-button external"><div class="li_l"><img src='+s.ImageUrl+' alt=""></div><div class="li_r"><div class="up_con">'+s.showName+'</div><div class="mid_con"><div class="pri_l"><p>&yen;<span class="pri_one">'+s.salePrice/100+'</span><s>&yen;<span class="pri_two">'+s.purchasePrice/100+'</span></s></p></div><div class="pri_r">送积分:<span>'+s.money+'</span></div></div><div class="down_con"><div class="sur_l">',a=e(s.totalStock,s.stock);return n+=1==a?'<p class="surplus" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'"><span class="span_f" style="width:4.5rem;border-radius: 8px"></span>':a>.9&&a<1?'<p class="surplus" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'"><span class="span_f" style="width:4.05rem;border-radius: 8px 0 0 8px"></span>':'<p class="surplus" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'"><span class="span_f" style="width:'+4.5*a+'rem;border-radius: 8px 0 0 8px" ></span>',n+='<span class="span_s">剩余<span>'+s.stock+'</span>个</span></p></div><div class="sur_r">立即抢<img src="../img/icoJiantou1.png"></div></div></div></a></li>'}function i(s){var n='<li class="over"><a href="goods_detail.html?onlineId='+s.onlineId+"&"+xhq.getVersion()+'" class="item-link list-button external"><div class="li_l"><img src='+s.ImageUrl+' alt=""></div><div class="li_r"><div class="up_con">'+s.showName+'</div><div class="mid_con"><div class="pri_l"><p>&yen;<span class="pri_one">'+s.salePrice/100+'</span><s>&yen;<span class="pri_two">'+s.purchasePrice/100+'</span></s></p></div><div class="pri_r">送积分:<span>'+s.money+'</span></div></div><div class="down_con"><div class="sur_l"><p class="surplus"><span class="span_f"></span><span class="span_s">剩余<span>0</span>个</span></p></div><div class="sur_r">已抢光<img src="../img/icoJiantou1.png"></div></div></div></a></li>';return n}function t(s){var n='<li class="waiting"><a href="goods_detail.html?onlineId='+s.onlineId+"&"+xhq.getVersion()+'" class="item-link list-button external"><div class="li_l"><img src='+s.ImageUrl+' alt=""></div><div class="li_r"><div class="up_con">'+s.showName+'</div><div class="mid_con"><div class="pri_l"><p>&yen;<span class="pri_one">'+s.salePrice/100+'</span><s>&yen;<span class="pri_two">'+s.purchasePrice/100+'</span></s></p></div><div class="pri_r">送积分:<span>'+s.money+'</span></div></div><div class="down_con"><div class="sur_l"><p class="surplus"><span class="span_f"></span><span class="span_s">剩余<span>'+s.stock+'</span>个</span></p></div><div class="sur_r">即将开始<img src="../img/icoJiantou1.png"></div></div></div></a></li>';return n}function e(s,n){return 0==s?1:n/s}1==xhq.getQuery("mode")&&2==getLocalSession("userType")&&$.alert("亲，您已经是店长了，系统将引导您至店长版本","温馨提醒",function(){xhq.gotoUrl("ws_home.html",{isWs:1})}),2==xhq.getQuery("fromUserType")||$("#toshop").hide(),$(document).on("pageInit","#page-ptr",function(n,a,i){$content=$(i).find(".content-block"),$(i).on("infinite",function(n){loading||(openIndicator(),loading=!0,setTimeout(function(){isAppendMode=1,s(),$.refreshScroller()},1e3))})}),$.init(),$(".today").on("tap",function(){1!=curtab&&($(this).addClass("active").siblings().removeClass("active"),$(this).find("img").attr("src","../img/icon_fire.png"),pageNo=0,isAppendMode=0,curdate=xhq.getToday(),curtab=1,openIndicator(),$.attachInfiniteScroll($content),s())}),$(".tomorrow").on("tap",function(){2!=curtab&&($(this).addClass("active"),$(".today").removeClass("active"),$(".today").find("img").attr("src","../img/icon_fire2.png"),pageNo=0,isAppendMode=0,curdate=getTommow(),curtab=2,openIndicator(),$.attachInfiniteScroll($content),s())}),openIndicator();var o='<div class="swiper-wrapper">',l={interId:"toc.getIndexBanners",channel:"C"};xhq.__runXHQ(l,function(n){if(0==n.status){if(null!=n.body&&n.body.length>0)for(var a=0;a<n.body.length;a++){var i=n.body[a];o=2==i.actType?o+'<div class="swiper-slide"><a href="banner_detail.html?actId='+i.actId+"&r="+Math.random()+"&"+xhq.getVersion()+'"><img src='+i.imgUrl+' alt=""></a></div>':o+'<div class="swiper-slide"><a class="external" href="'+i.linkUrl+'"><img src='+i.imgUrl+' alt=""></a></div>'}if(o+='</div><div class="swiper-pagination"></div>',$(".swiper-container").html(o),n.body.length>1){new Swiper(".swiper-container",{pagination:".swiper-pagination",paginationClickable:!0,spaceBetween:30,centeredSlides:!0,autoplay:2500,autoplayDisableOnInteraction:!1})}s()}else hideIndicator(),$.toast(n.message)}),shareHome(),wx.ready(function(){wx.onMenuShareAppMessage(shareConfig),wx.onMenuShareTimeline(shareConfig)}),$("#tome").on("tap",function(){2==getLocalSession("userType")?xhq.gotoUrl("ws_me.html"):xhq.gotoUrl("me.html")}),$("#totour").on("tap",function(){xhq.gotoUrl("tour.html")}),$("#totype").on("tap",function(){xhq.gotoUrl("goodtypes.html")}),$("#toshop").on("tap",function(){xhq.gotoUrl("ws_shop.html")})});