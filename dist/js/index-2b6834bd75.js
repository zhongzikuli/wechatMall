function getTommow(){var s=new Date;return s.setDate(s.getDate()+1),s.getFullYear()+"-"+(s.getMonth()+1<10?"0":"")+(s.getMonth()+1)+"-"+((s.getDate()<10?"0":"")+s.getDate())}function openIndicator(){$.showIndicator(),isIndicator=!0}function hideIndicator(){isIndicator&&($.hideIndicator(),isIndicator=!1),loading=!1}var pageNo=0,pageSize=20,curdate=xhq.getToday(),isIndicator=!1,isAppendMode=1,$content=null,loading=!1,curtab=1;$(function(){function s(){pageNo+=1;var s={interId:"toc.getGoodsOnline",channel:"C",date:curdate,sortType:1,filter:1,pageNo:pageNo,pageSize:pageSize};xhq.__runXHQ(s,function(s){0==s.status?(t(s),(null==s.body||s.body.length<pageSize)&&($.detachInfiniteScroll($content),$(".infinite-scroll-preloader").remove()),loading=!1):(hideIndicator(),$.toast(s.message)),hideIndicator()})}function t(s){var t="";if(0==isAppendMode&&($(".content-block .list_container").html(""),isAppendMode=1),null!=s.body&&s.body.length>0){for(var l=0;l<s.body.length;l++){var o=s.body[l];1==o.status?t+=e(o):2==o.status||4==o.status?t+=n(o):3==o.status&&(t+=i(o))}$(".content-block .list_container").append(t),a()}}function a(){for(var s=0;s<$(".surplus").length;s++){var t=$(".surplus").width(),a=$(".surplus").eq(s).attr("totalStock"),e=$(".surplus").eq(s).attr("stock"),n=$(".surplus").eq(s).attr("status"),i=l(a,e);if(2==n||4==n)$(".surplus").eq(s).find(".span_f").attr("style","width:0");else if(i>=1)$(".surplus").eq(s).find(".span_f").attr("style","width:"+t+"px;border-radius:8px;");else if(0==i)$(".surplus").eq(s).find(".span_f").attr("style","width:0");else if(i>=.9)$(".surplus").eq(s).find(".span_f").attr("style","width:"+.9*t+"px");else{var o=t*i;$(".surplus").eq(s).find(".span_f").attr("style","width:"+o+"px;")}}}function e(s){var t='<li class="goodsclass"><a href="goods_detail.html?onlineId='+s.onlineId+"&"+xhq.getVersion()+'" class="selling_item ongoing" data-transition="slide-in"><div class="selling_pic"><img src='+s.ImageUrl+">",a=l(s.totalStock,s.stock);return t+=a>=1?'<p class="surplus" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'"><span class="span_f"   style="width:0rem;border-radius:8px;">':0==a?'<p class="surplus" style="background:rgba(0,0,0,0.25)" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'"><span  class="span_f" style="width:0">':a>=.9?'<p class="surplus" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'"><span class="span_f" style="width:0rem">':'<p class="surplus" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'"><span class="span_f"  style="width:0rem" >',t+='</span><span class="span_s">剩余<span>'+s.stock+'</span>个</span> </p></div><div class="selling_text"><div class="selling_title">'+s.showName+'</div><div class="selling_price"><div class="price_detail"><p class="price_one"><span>特卖价</span><span>&yen;'+s.salePrice/100+'</span></p><p class="price_two"> 平日：<s>&yen;'+s.purchasePrice/100+"</s></p>",t+=null==s.endTime||void 0==s.endTime?'<p class="deadline"></p></div><div class="go_buy">立即抢<p class="bonus">送积分：<span>'+s.money+"</span></p></div></div></div></a></li>":'<p class="deadline"><span>'+s.endTime+'</span>结束</p></div><div class="go_buy">立即抢<p class="bonus">送积分：<span>'+s.money+"</span></p></div></div></div></a></li>"}function n(s){return'<li class="goodsclass"><a href="goods_detail.html?onlineId='+s.onlineId+"&"+xhq.getVersion()+'" class="selling_item ended" data-transition="slide-in"><div class="selling_pic"><img src='+s.ImageUrl+'><p class="surplus" stype="background:rgba(0,0,0,0.25)" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'"><span class="span_f" stype="width:0"></span><span class="span_s">剩余<span>0</span>个</span></p></div><div class="selling_text"><div class="selling_title">'+s.showName+'</div><div class="selling_price"><div class="price_detail"><p class="price_one"><span>特卖价</span><span>&yen;'+s.salePrice/100+'</span></p><p class="price_two"> 平日：<s>&yen;'+s.purchasePrice/100+'</s></p><p class="deadline">抢购结束</p></div><div class="go_buy">已抢完<p class="bonus">送积分：<span>'+s.money+"</span></p></div></div></div></a></li>"}function i(s){return'<li class="goodsclass" totalStock='+s.totalStock+" data_id="+s.onlineId+'><a href="goods_detail.html?onlineId='+s.onlineId+"&"+xhq.getVersion()+'" class="selling_item waiting" data-transition="slide-in"><div class="selling_pic"><img src='+s.ImageUrl+'><p class="surplus" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'"><span class="span_f" stype="width:width:0rem",border-radius:8px"></span><span class="span_s">剩余<span>'+s.stock+'</span>个</span></p></div><div class="selling_text"><div class="selling_title">'+s.showName+'</div><div class="selling_price"><div class="price_detail"><p class="price_one"><span>特卖价</span><span>&yen;'+s.salePrice/100+'</span></p><p class="price_two">平日：<s>&yen;'+s.purchasePrice/100+'</s></p><p class="deadline "><span>'+s.startTime+'</span>开始抢购</p></div><div class="go_buy">立即抢<p class="bonus">送积分：<span>'+s.money+"</span></p></div></div></div></a></li>"}function l(s,t){return 0==s?1:t/s}$(document).on("pageInit","#page-ptr",function(t,a,e){$content=$(e).find(".content-block"),$(e).on("infinite",function(t){loading||(openIndicator(),loading=!0,setTimeout(function(){isAppendMode=1,s(),$.refreshScroller()},1e3))})}),$.init(),$("#todays").on("tap",function(){1!=curtab&&($(this).find(".selling_text").addClass("active"),$(".selling_date").addClass("active"),$(".item-title").removeClass("active"),pageNo=0,isAppendMode=0,curdate=xhq.getToday(),curtab=1,openIndicator(),$.attachInfiniteScroll($content),s())}),$("#torrmors").on("tap",function(){2!=curtab&&($(this).find(".item-title").addClass("active"),$(".selling_date").removeClass("active"),$(".selling_text").removeClass("active"),pageNo=0,isAppendMode=0,curdate=getTommow(),curtab=2,openIndicator(),$.attachInfiniteScroll($content),s())}),$("#changeBtn").on("tap",function(){xhq.gotoUrl("change_list.html")}),$("#orderBtn").on("tap",function(){xhq.gotoUrl("order_list.html")}),$("#familyBtn").on("tap",function(){return 2!=getLocalSession("userType")?void xhq.gotoRegUrl():void xhq.gotoUrl("my_family.html")}),$("#inviteBtn").on("tap",function(){return 2!=getLocalSession("userType")?void xhq.gotoRegUrl():void xhq.gotoUrl("invite_friend.html")}),openIndicator();var o='<div class="swiper-wrapper">',c={interId:"toc.getIndexBanners",channel:"C"};xhq.__runXHQ(c,function(t){if(0==t.status){if(null!=t.body&&t.body.length>0)for(var a=0;a<t.body.length;a++){var e=t.body[a];o=2==e.actType?o+'<div class="swiper-slide"><a href="banner_detail.html?actId='+e.actId+"&r="+Math.random()+"&"+xhq.getVersion()+'"><img src='+e.imgUrl+"></a></div>":o+'<div class="swiper-slide"><a class="external" href="'+e.linkUrl+'"><img src='+e.imgUrl+"></a></div>"}if(o+='</div><div class="swiper-pagination"></div>',$(".swiper-container").html(o),t.body.length>1){new Swiper(".swiper-container",{pagination:".swiper-pagination",paginationClickable:!0,spaceBetween:30,centeredSlides:!0,autoplay:2500,autoplayDisableOnInteraction:!1})}s()}else hideIndicator(),$.toast(t.message)});var d=new Date,r=d.getMonth()+1,p=d.getDate(),u=new Array("星期日","星期一","星期二","星期三","星期四","星期五","星期六");$(".special_date").html(r+"."+p),$(".special_weekday").html(u[d.getDay()]),$("#tome").on("tap",function(){xhq.gotoUrl("me.html")}),$("#tofresh").on("tap",function(){xhq.gotoUrl("tour.html")}),$("#totype").on("tap",function(){xhq.gotoUrl("goodtypes.html")})});