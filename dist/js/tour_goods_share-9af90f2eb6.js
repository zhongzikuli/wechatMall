function openIndicator(){$.showIndicator(),isIndicator=!0}function hideIndicator(){isIndicator&&($.hideIndicator(),isIndicator=!1)}function showEndTime(){for(var o=new Date,e=o.getTime(),n=0;n<endArr.length;n++){var r,a,i,s,t,l=endArr[n],d=l.indexOf("="),c=l.substr(0,d),u=l.substr(d+1),g=u-e;g>=0?(r=Math.floor(g/1e3/60/60/24),a=Math.floor(g/1e3/60/60%24),i=Math.floor(g/1e3/60%60),s=Math.floor(g/1e3%60),a=a>=0&&a<=9?"0"+a:a,i=i>=0&&i<=9?"0"+i:i,s=s>=0&&s<=9?"0"+s:s,t="剩余"+a+":"+i+":"+s+"结束"):(t="此拼团已结束",$("nav1").hide(),$("nav2").show()),$("#timeEnd_"+c).html(t)}}function setBuyNowLocalSession(o){setLocalSession("localOrderSession",null);var e;if(null!=o){var n=getBuyJSON(o),r=new Array;n.num=1,r[0]=n,e=r;var a=JSON.stringify(e);setLocalSession("localOrderSession",a),console.log("LocalSession="+getLocalSession("localOrderSession"))}}function gotoOrder(o){var e=arrDetailInfo;e.salePrice=arrDetailInfo.grouponPrice,setBuyNowLocalSession(e);var n=o?{mailType:"lkgm",channelType:4,sourceType:4,groupId:o}:{mailType:"lkgm",channelType:5,sourceType:4};xhq.gotoUrl("order.html",n)}var isIndicator=!1,arrDetailInfo=null,grouponId=xhq.getQuery("grouponId"),status=1,endArr=[];$(function(){function o(o){if(o.body){e(o.body.images),$("#grouponNum").html(o.body.grouponNum||0),$("#groupPrice").html((o.body.grouponPrice||0)/100),$("#purchasePrice").html((o.body.purchasePrice||0)/100),$("#salesVolume").html(o.body.salesVolume||0),$(".goods_text").html(o.body.showName||""),$(".goods_bri").html(o.body.conduct||"");var n='<div class="pic_box">';if(o.body.groupons||o.body.groupons.length>0)for(var r=0;r<o.body.groupons.length;r++){var a=o.body.groupons[r];n+=1==a.isOwner&&0==r?'<div class="tourer"><img src='+a.headimgUrl+' alt=""><span>团长</span></div>':'<div class="toured"><img src='+a.headimgUrl+' alt=""></div>'}var i=(o.body.grouponNum||0)-(o.body.realNum||0);if(i<0&&(i=0),i>0)for(var r=0;r<i;r++)n+='<div class="toured unknow"><img src="../img/unknow.png" alt=""></div>';if(n+="</div>",status=o.body.status,1==status){n+='<div class="text_box none">仅剩<span class="span_f">'+i+'</span>个名额<br><span class="span_s" id="timeEnd_'+grouponId+'"></span></div>',$(".mid_box").html(n);var s=o.body.endTime;s=s.replace(/-/g,":").replace(" ",":"),s=s.split(":");var t=new Date(s[0],s[1]-1,s[2],s[3],s[4],s[5]);endArr.push(grouponId+"="+t.getTime()),showEndTime(),setInterval(showEndTime,1e3)}else n+='<div class="text_box none">仅剩<span class="span_f">'+i+"</span>个名额<br>此拼团已结束 </div>",$(".mid_box").html(n),$("#nav1").css("display","none"),$("#nav2").css("display","block");shareTitle="我买了"+(o.body.grouponPrice||0)/100+"元 "+o.body.showName,shareIcon=o.body.bigPic,shareIcon=shareIcon.trim(),shareUrl=xhq.getDomainUrl()+"tour_goods_share.html?grouponId="+grouponId+"&"+xhq.getVersion(),shareConfig={title:shareTitle,desc:"【还差"+i+"人】"+o.body.conduct,link:shareUrl,imgUrl:shareIcon},xhq.initWXJsConfig()}}function e(o){if(o){var e=o.split(",");if(e&&!(e.length<1)){var n="";for(var r in e)n+='<div class="swiper-slide"><img src="'+e[r]+'" alt=""></div>';if($("#sw_data").html(n),e.lenght>1){new Swiper(".swiper-container",{pagination:".swiper-pagination",paginationClickable:!0,spaceBetween:30,centeredSlides:!0,autoplay:2500,autoplayDisableOnInteraction:!1})}}}}if(!grouponId)return void $.toast("系统异常，缺少团号");openIndicator();var n={interId:"toc.getGrouponShareDetail",channel:"C",grouponId:grouponId};xhq.__runXHQ(n,function(e){if(hideIndicator(),0==e.status){console.log("toc.getOnlineDetail="+JSON.stringify(e));var n=e.body;arrDetailInfo=n,o(e)}else $.toast(e.message)}),$("#toMore").tap(function(){xhq.gotoUrl("tour.html")}),$("#toMore2").tap(function(){xhq.gotoUrl("tour.html")}),$(".go_tour").on("tap",function(){1==status&&gotoOrder(grouponId)}),wx.ready(function(){wx.onMenuShareAppMessage(shareConfig),wx.onMenuShareTimeline(shareConfig)})});