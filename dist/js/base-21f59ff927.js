function getLocalSession(e){return window.localStorage?void 0==localStorage[e]?null:localStorage[e]:null}function setLocalSession(e,o){window.localStorage&&(localStorage[e]=o)}function setSession(e,o){window.sessionStorage&&(sessionStorage[e]=o)}function getSession(e){return window.sessionStorage?void 0==sessionStorage[e]?null:sessionStorage[e]:null}var DEFAULT_HEADIMG="../img/default_headimg.png",DRAW_MIN_MONEY=1e4,g_wxappid="wx6c900731ed087ec5",CUR_HTML_VERSION=2003;!function($){function errorPage(){window.location.href=g_ajax_url+"/dist/html/errorPage.html"}function initAnalyse(){search=window.location.search;var e;if(null!=search&&void 0!=search){search=search.substr(1),kvs=search.split("&");for(i in kvs)kv=kvs[i],value=kv.split("="),kv.indexOf("openid=")!=-1&&setLocalSession("openid",value[1]),kv.indexOf("code=")!=-1&&(e=value[1])}if(null==getLocalSession("openid")||void 0==getLocalSession("openid")||""==getLocalSession("openid"))if(null==e||void 0==e||""==e){var o=encodeURI(window.location);window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+g_wxappid+"&redirect_uri="+o+"&response_type=code&scope=snsapi_userinfo&state=1234#wechat_redirect"}else getWxInfoByCodeOrOpenid(e,1);else null!=getLocalSession("token")&&void 0!=getLocalSession("token")&&""!=getLocalSession("token")||getWxInfoByCodeOrOpenid(getLocalSession("openid"),2)}function checkWX(){return!!debug||void(isWeiXin()||errorPage())}function isWeiXin(){var e=window.navigator.userAgent.toLowerCase();return"micromessenger"==e.match(/MicroMessenger/i)}function check(){for(i in g_pubCheck){var func=g_pubCheck[i];eval(func)}}function getWxInfoByCodeOrOpenid(e,o){var s=null;s=1==o?{interId:"toc.getWxUserInfoByAuth",channel:"C",code:e}:{interId:"toc.getWxUserInfoByAuth",channel:"C",openid:e},xhq.__runXHQ(s,huancun)}function huancun(e){0==e.status?(setLocalSession("custId",e.body.custId),setLocalSession("openid",e.body.openid),setLocalSession("phoneNo",e.body.phoneNo),setLocalSession("custNumber",e.body.custNumber),setLocalSession("nickName",e.body.nickName||"暂无昵称"),setLocalSession("headimgUrl",e.body.headimgUrl||DEFAULT_HEADIMG),setLocalSession("sex",e.body.sex),setLocalSession("userType",e.body.userType),setLocalSession("level",e.body.level),setLocalSession("inviteCode",e.body.inviteCode||"无邀请码"),setLocalSession("token",e.body.token),setLocalSession("localAddressSession",""),setLocalSession("localOrderSession",""),setLocalSession("shoppingCartLocalSession","")):(setLocalSession("custId",""),setLocalSession("openid",""),setLocalSession("phoneNo",""),setLocalSession("custNumber",""),setLocalSession("nickName",""),setLocalSession("headimgUrl",""),setLocalSession("sex",""),setLocalSession("userType",1),setLocalSession("level",""),setLocalSession("inviteCode",""),setLocalSession("token",""),setLocalSession("localAddressSession",""),setLocalSession("localOrderSession",""),setLocalSession("shoppingCartLocalSession",""),$.toast(e.message))}var debug=!1,g_ajax_url="http://qmjs.xiaohongquan.cn",g_domain_url="http://qmjs.xiaohongquan.cn",g_localParams=[],g_sessionParams=[],g_session=["openid"],_globalLoading;g_pubCheck=["checkWX()","initAnalyse()"],window.xhq={wxPay:function(e,o,s){function n(){WeixinJSBridge.invoke("getBrandWCPayRequest",t,function(e){"get_brand_wcpay_request:ok"==e.err_msg?o():s()})}var t=$.extend({signType:"MD5"},e);s=s||function(){$.toast("支付失败")},"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",n,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",n),document.attachEvent("onWeixinJSBridgeReady",n)):n()},tobGetVerificationCode:function(e,o,s){if(!e.attr("disabled")){var n=new RegExp("^(13[0-9]|15[012356789]|17[0135678]|18[0-9]|14[57])[0-9]{8}$","ig");if(!n.test(o))return void $.toast("手机号码错误");var t={interId:"tob.getVerificationCode",channel:"C",phoneNo:o},i=e.html();e.html("发送中.."),e.attr("disabled","disabled"),xhq.__runXHQ(t,function(o){if(0==o.status){var n=60,t=setInterval(function(){--n<1?(t&&clearInterval(t),e.attr("disabled",null).html(i)):e.html(i+"("+n+")")},1e3);s&&s()}else e.attr("disabled",null),$.toast(o.message)})}},gotoErrorPage:function(){errorPage()},getToday:function(){var e=new Date;return e.getFullYear()+"-"+(e.getMonth()+1<10?"0":"")+(e.getMonth()+1)+"-"+((e.getDate()<10?"0":"")+e.getDate())},initWXJsConfig:function(e){if(null!=getLocalSession("custId")&&void 0!=getLocalSession("custId")){var o=JSON.stringify({url:location.href}),s=g_ajax_url+"/wxconfig",n=["onMenuShareTimeline","onMenuShareAppMessage","scanQRCode"];e&&e.length>0&&(n=n.concat(e)),$.ajax({type:"POST",url:s,data:o,success:function(e){var o=JSON.parse(e);wx.config({debug:!1,appId:o.body.appId,timestamp:o.body.timestamp,nonceStr:o.body.noncestr,signature:o.body.sign,jsApiList:n})}})}},getShareUrl:function(){var e=g_domain_url+location.pathname+"?fromCustId="+getLocalSession("custId"),o=location.search,s=o.match(new RegExp("[?&][^?&]+=[^?&]+","g"));if(null==s)return e;for(var n="",t=0;t<s.length;t++)_tmp=s[t].substring(1).split("="),"appId"!=_tmp[0]&&"fromCustId"!=_tmp[0]&&"openid"!=_tmp[0]&&(n+="&"+_tmp[0]+"="+_tmp[1]);return e+n},isCustomer:function(){return 2==getLocalSession("userType")},getDomainUrl:function(){return g_domain_url+"/dist/html/"},gotoUrl:function(e,o){o=o||{},$.extend(o,{version:CUR_HTML_VERSION}),!o.fromCustId&&xhq.getQuery("fromCustId")?(o.fromCustId=xhq.getQuery("fromCustId"),o.fromUserType=xhq.getQuery("fromUserType")||"0"):!o.isWs&&xhq.getQuery("isWs")&&(o.isWs=xhq.getQuery("isWs")||"0"),e=xhq.getUrl(e,o),location.href=e},gotoRegUrl:function(e,o){xhq.gotoUrl("selfreg.html",o)},getVersion:function(){var e="version="+CUR_HTML_VERSION;return xhq.getQuery("fromCustId")||1!=xhq.getQuery("isWs")||(e+="&isWs=1"),xhq.getQuery("fromCustId")?e+"&fromCustId="+xhq.getQuery("fromCustId")+"&fromUserType="+xhq.getQuery("fromUserType")||"0":e},getUrl:function(e,o){if(o=o||{},e.indexOf("http://")==-1){var s,n,t,i=document.createElement("a");i.href=e,s=i.pathname,n=i.hash,t=xhq.getQuery(null,e),t=t||{},$.extend(o,t),e=s+"?"+$.param(o)+n}return e},getQuery:function(e,o){var s=location.search;if(o){var n=document.createElement("a");n.href=o,s=n.search}var t,i={},a=s.match(new RegExp("[?&][^?&]+=[^?&]+","g"));if(null==a)return"";for(var r=0;r<a.length;r++){t=a[r].substring(1);var c=t.indexOf("="),l=t.substr(0,c),u=t.substr(c+1);i[l]=decodeURIComponent(u)}return e?i[e]:i},__runXHQ:function(e,o,s){e.channel="C";var n=JSON.stringify(e),t=Math.round((new Date).getTime()/1e3),i=getLocalSession("token");null!=i&&void 0!=i&&""!=i||(i="tyuiggl55663ddsd");var a=g_ajax_url+"/service?token="+i+"&time="+t;$.ajax({type:"POST",url:a,data:n,success:function(e){var s=JSON.parse(e);100==s.status?(setLocalSession("custId",""),setLocalSession("openid",""),setLocalSession("phoneNo",""),setLocalSession("custNumber",""),setLocalSession("nickName",""),setLocalSession("headimgUrl",""),setLocalSession("sex",""),setLocalSession("userType",1),setLocalSession("level",""),setLocalSession("inviteCode",""),setLocalSession("token",""),setLocalSession("localAddressSession",""),setLocalSession("localOrderSession",""),setLocalSession("shoppingCartLocalSession",""),check()):o(s)}})}},debug||check()}(Zepto);