function openIndicator(){$.showIndicator(),isIndicator=!0}function hideIndicator(){isIndicator&&($.hideIndicator(),isIndicator=!1),loading=!1}function showNoDataPage(){$("#showdiv1").css("display","none"),$("#showdiv2").css("display","block")}function saveKeyword(s){var a=getLocalSession("search_records")||"",t=[];""!=a&&(t=a.split("|"));for(var e=0,o=0;o<t.length;o++)if(t[o]==s){e=1;break}if(!e){var n=[];n[0]=s;for(var o=0;o<t.length&&!(o+1>9);o++)n[o+1]=t[o];setLocalSession("search_records",n.join("|"))}}var pageNo=0,pageSize=20,isIndicator=!1,$content=null,loading=!1,sortType=1,preTabId=$("#tab_zh").attr("id"),typeId=0,typeName="",topTypeName="",keyword="",primeTypeId=0;$(function(){function s(){pageNo+=1;var s={interId:"toc.getGoodsOnline",channel:"C",typeId:typeId,primeTypeId:primeTypeId,keyword:keyword,sortType:sortType,filter:2,pageNo:pageNo,pageSize:pageSize,topTypeName:topTypeName,isWs:1,custId:getLocalSession("custId")};xhq.__runXHQ(s,function(s){0==s.status?(a(s),(null==s.body||s.body.length<pageSize)&&($.detachInfiniteScroll($content),$(".infinite-scroll-preloader").css("display","none")),1!=pageNo||s.body&&s.body.length||showNoDataPage(),loading=!1):(hideIndicator(),$.toast(s.message)),hideIndicator()})}function a(s){var a="";if(null!=s.body&&s.body.length>0){for(var o=0;o<s.body.length;o++){var n=s.body[o];a+=n.isOnline&&n.isOnline>0?e(n):t(n)}1==pageNo?$(".content-block .list_container").html(a):$(".content-block .list_container").append(a)}}function t(s){var a='<li class="ws_li"><a href="goods_detail.html?onlineId='+s.onlineId+"&"+xhq.getVersion()+'" class="item-link list-button external" data-transition="slide-in"><div class="selling_pic"><img src='+s.ImageUrl+'></div><div class="selling_text"><div class="selling_title">'+s.showName+'</div><div class="selling_price"><div class="pri_l">';if(a+=s.purchasePrice&&s.purchasePrice>0?'<p>¥<span class="pri_one">'+s.salePrice/100+'</span><s>¥<span class="pri_two">'+s.purchasePrice/100+"</span></s></p>":'<p>¥<span class="pri_one">'+s.salePrice/100+'</span><s><span class="pri_two"></span></s></p>',a+='</div><div class="pri_r">赚: ¥<span>'+s.bonus/100+'</span></div></div><div class="go_buy"><div class="sur_l">',s.stock<=0)a+='<p class="surplus"><span class="span_f"></span><span class="span_s">剩余<span>0</span>个</span></p></div>';else{var t=o(s.totalStock,s.stock);a+=1==t?'<p class="surplus" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'"><span class="span_f" style="width:4.5rem;border-radius: 8px"></span>':t>.9&&t<1?'<p class="surplus" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'"><span class="span_f" style="width:4.05rem;border-radius: 8px 0 0 8px"></span>':'<p class="surplus" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'"><span class="span_f" style="width:'+4.5*t+'rem;border-radius: 8px 0 0 8px" ></span>',a+='<span class="span_s">剩余<span>'+s.stock+"</span>个</span></p></div>"}return a+='</div></div></a><div class="sur_r uptoshop" data_id='+s.onlineId+'><img src="../img/icon_shi.png" alt=""></div></li>'}function e(s){var a='<li class="lied"><a href="goods_detail.html?onlineId='+s.onlineId+"&"+xhq.getVersion()+'" class="item-link list-button external" data-transition="slide-in"><div class="selling_pic"><img src='+s.ImageUrl+'></div><div class="selling_text"><div class="selling_title">'+s.showName+'</div><div class="selling_price"><div class="pri_l">';if(a+=s.purchasePrice&&s.purchasePrice>0?'<p>¥<span class="pri_one">'+s.salePrice/100+'</span><s>¥<span class="pri_two">'+s.purchasePrice/100+"</span></s></p>":'<p>¥<span class="pri_one">'+s.salePrice/100+'</span><s><span class="pri_two"></span></s></p>',a+='</div><div class="pri_r">赚: ¥<span>'+s.bonus/100+'</span></div></div><div class="go_buy"><div class="sur_l">',s.stock<=0)a+='<p class="surplus"><span class="span_f"></span><span class="span_s">剩余<span>0</span>个</span></p></div>';else{var t=o(s.totalStock,s.stock);a+=1==t?'<p class="surplus" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'"><span class="span_f" style="width:4.5rem;border-radius: 8px"></span>':t>.9&&t<1?'<p class="surplus" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'"><span class="span_f" style="width:4.05rem;border-radius: 8px 0 0 8px"></span>':'<p class="surplus" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'"><span class="span_f" style="width:'+4.5*t+'rem;border-radius: 8px 0 0 8px" ></span>',a+='<span class="span_s">剩余<span>'+s.stock+"</span>个</span></p></div>"}return a+='</div></div></a><div class="sur_r">已添加</div></li>'}function o(s,a){return 0==s?1:a/s}2!=getLocalSession("userType")&&$.alert("亲，您尚未注册成为全民集市的店长，请先注册","温馨提醒",function(){xhq.gotoRegUrl()}),$(document).on("pageInit","#page-ptr",function(a,t,e){$content=$(e).find(".content-block"),$(e).on("infinite",function(a){loading||(openIndicator(),loading=!0,setTimeout(function(){s(),$.refreshScroller()},1e3))})}),$(".tab-link").on("click",function(a){var t=$(this).attr("id"),e=0;t!=preTabId?(sortType="tab_zh"==t?1:"tab_xl"==t?2:"tab_fh"==t?3:4,e=1,$("#"+preTabId).removeClass("active"),$(this).addClass("active"),preTabId=t):"tab_jg"==t&&(sortType=4==sortType?5:4,e=1),1==e&&(openIndicator(),pageNo=0,s(),$.attachInfiniteScroll($content),$(".infinite-scroll-preloader").css("display","block"))}),$("#search_goods").on("tap",function(){xhq.gotoUrl("search_record.html",{keyword:keyword,isWs:1})}),$.init(),openIndicator(),typeId=xhq.getQuery("typeId"),primeTypeId=xhq.getQuery("primeTypeId"),typeName=xhq.getQuery("typeName")||"",keyword=xhq.getQuery("keyword")||"",topTypeName=xhq.getQuery("topTypeName")||"",""!=keyword?($("#search_goods").val(keyword),saveKeyword(keyword)):""!=typeName?$("#search_goods").val(typeName):""!=topTypeName&&$("#search_goods").val(topTypeName),s(),$(".list_container").on("tap","li .uptoshop",function(){var s=$(this),a=$(this).attr("data_id"),t={interId:"toc.custUpOnline",channel:"C",custId:getLocalSession("custId"),onlineId:a};$.showIndicator(),xhq.__runXHQ(t,function(a){$.hideIndicator(),0==a.status?(s.removeClass("uptoshop"),s.parent().removeClass("ws_li"),s.parent().addClass("lied"),s.html("已添加"),$.toast("上架成功")):$.toast(a.message)})})});