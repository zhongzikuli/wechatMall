var fromCustId,custId;$(function(){if(fromCustId=xhq.getQuery("fromCustId")||0,0==fromCustId)return void xhq.gotoErrorPage();if(custId=getLocalSession("custId"),0==custId)return void xhq.gotoErrorPage();$.showIndicator();var t={interId:"toc.getCustInfoByInvitecode",channel:"C",fromCustId:fromCustId};xhq.__runXHQ(t,function(t){0==t.status&&void 0!=t.body&&null!=t.body&&t.body.custId>0?($("#sharerName1").html(t.body.nickName||""),$("#sharerImg").attr("src",t.body.headimgUrl||DEFAULT_HEADIMG),$.hideIndicator()):($.hideIndicator(),xhq.gotoErrorPage())}),$("#btnGetCode").on("tap",function(t){var o=$.trim($("#newPhoneNo").val());xhq.tobGetVerificationCode($(this),o,function(){$.toast("验证码已发送")})}),$("#buttonPay").on("tap",function(t){var o=$.trim($("#newPhoneNo").val()),n=$.trim($("#verficode").val());if(null==o||""==o)return void $.toast("手机号码未录入");if(11!=o.length)return void $.toast("手机号码长度不正确，请检查");if(null==n||""==n)return void $.toast("验证码未录入");if(4!=n.length)return void $.toast("验证码长度为4位，请检查");$.showIndicator();var r={interId:"toc.registerCust",channel:"C",custId:custId,fromCustId:fromCustId,phoneNo:o,verificationCode:n};xhq.__runXHQ(r,function(t){if(0==t.status){var o={};o.appId=t.body.appId,o.nonceStr=t.body.nonceStr.toString(),o["package"]=t.body.packageInfo,o.paySign=t.body.paySign,o.timeStamp=t.body.timeStamp+"",xhq.wxPay(o,function(t){$.hideIndicator(),setLocalSession("userType",2),xhq.gotoUrl("open_end.html")},function(){$.hideIndicator(),$.toast("支付失败")})}else $.hideIndicator(),$.toast(t.message)})})});