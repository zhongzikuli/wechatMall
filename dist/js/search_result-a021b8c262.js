function openIndicator(){$.showIndicator(),isIndicator=!0}function hideIndicator(){isIndicator&&($.hideIndicator(),isIndicator=!1),loading=!1}function showNoDataPage(){$("#showdiv1").css("display","none"),$("#showdiv2").css("display","block")}function saveKeyword(s){var t=getLocalSession("search_records")||"",a=[];""!=t&&(a=t.split("|"));for(var e=0,o=0;o<a.length;o++)if(a[o]==s){e=1;break}if(!e){var i=[];i[0]=s;for(var o=0;o<a.length&&!(o+1>9);o++)i[o+1]=a[o];setLocalSession("search_records",i.join("|"))}}var pageNo=0,pageSize=20,isIndicator=!1,$content=null,loading=!1,sortType=1,preTabId=$("#tab_zh").attr("id"),typeId=0,typeName="",topTypeName="",keyword="",primeTypeId=0;$(function(){function s(){pageNo+=1;var s={interId:"toc.getGoodsOnline",channel:"C",typeId:typeId,primeTypeId:primeTypeId,keyword:keyword,sortType:sortType,filter:2,pageNo:pageNo,pageSize:pageSize,topTypeName:topTypeName};xhq.__runXHQ(s,function(s){0==s.status?(t(s),(null==s.body||s.body.length<pageSize)&&($.detachInfiniteScroll($content),$(".infinite-scroll-preloader").css("display","none")),1!=pageNo||s.body&&s.body.length||showNoDataPage(),loading=!1):(hideIndicator(),$.toast(s.message)),hideIndicator()})}function t(s){var t="";if(null!=s.body&&s.body.length>0){for(var o=0;o<s.body.length;o++){var i=s.body[o];t+=1==i.isSale?a(i):e(i)}1==pageNo?$(".content-block .list_container").html(t):$(".content-block .list_container").append(t)}}function a(s){var t='<li><a href="goods_detail.html?onlineId='+s.onlineId+"&"+xhq.getVersion()+'" class="item-link list-button external" data-transition="slide-in"><div class="selling_pic"><img src='+s.ImageUrl+'></div><div class="selling_text"><div class="selling_title">'+s.showName+'</div><div class="selling_price"><div class="pri_l"><p>&yen;<span class="pri_one">'+s.salePrice/100+'</span><s>&yen;<span class="pri_two">'+s.purchasePrice/100+'</span></s></p></div><div class="pri_r">送积分:<span>'+s.money+'</span></div></div><div class="go_buy"><div class="sur_l">',a=o(s.totalStock,s.stock);return t+=1==a?'<p class="surplus" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'"><span class="span_f" style="width:4.5rem;border-radius: 8px"></span>':a>.9&&a<1?'<p class="surplus" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'"><span class="span_f" style="width:4.05rem;border-radius: 8px 0 0 8px"></span>':'<p class="surplus" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'"><span class="span_f" style="width:'+4.5*a+'rem;border-radius: 8px 0 0 8px" ></span>',t+='<span class="span_s">剩余<span>'+s.stock+'</span>个</span></p></div><div class="sur_r">立即抢<img src="../img/icoJiantou1.png"></div></div></div></a></li>'}function e(s){var t='<li><a href="goods_detail.html?onlineId='+s.onlineId+"&"+xhq.getVersion()+'" class="item-link list-button external" data-transition="slide-in"><div class="selling_pic"><img src='+s.ImageUrl+'></div><div class="selling_text"><div class="selling_title">'+s.showName+'</div><div class="selling_price"><div class="pri_l"><p>&yen;<span class="pri_one">'+s.salePrice/100+'</span><s><span class="pri_two"></span></s></p></div><div class="pri_r">送积分:<span>'+s.money+'</span></div></div><div class="go_buy"><div class="sur_l">',a=o(s.totalStock,s.stock);return t+=1==a?'<p class="surplus" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'"><span class="span_f" style="width:4.5rem;border-radius: 8px"></span>':a>.9&&a<1?'<p class="surplus" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'"><span class="span_f" style="width:4.05rem;border-radius: 8px 0 0 8px"></span>':'<p class="surplus" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'"><span class="span_f" style="width:'+4.5*a+'rem;border-radius: 8px 0 0 8px" ></span>',t+='<span class="span_s">剩余<span>'+s.stock+'</span>个</span></p></div><div class="sur_r">立即抢<img src="../img/icoJiantou1.png"></div></div></div></a></li>'}function o(s,t){return 0==s?1:t/s}$(document).on("pageInit","#page-ptr",function(t,a,e){$content=$(e).find(".content-block"),$(e).on("infinite",function(t){loading||(openIndicator(),loading=!0,setTimeout(function(){s(),$.refreshScroller()},1e3))})}),$(".tab-link").on("click",function(t){var a=$(this).attr("id"),e=0;a!=preTabId?(sortType="tab_zh"==a?1:"tab_xl"==a?2:"tab_fh"==a?3:4,e=1,$("#"+preTabId).removeClass("active"),$(this).addClass("active"),preTabId=a):"tab_jg"==a&&(sortType=4==sortType?5:4,e=1),1==e&&(openIndicator(),pageNo=0,s(),$.attachInfiniteScroll($content),$(".infinite-scroll-preloader").css("display","block"))}),$("#search_goods").on("tap",function(){xhq.gotoUrl("search_record.html",{keyword:keyword})}),$.init(),openIndicator(),typeId=xhq.getQuery("typeId"),primeTypeId=xhq.getQuery("primeTypeId"),typeName=xhq.getQuery("typeName")||"",keyword=xhq.getQuery("keyword")||"",topTypeName=xhq.getQuery("topTypeName")||"",""!=keyword?($("#search_goods").val(keyword),saveKeyword(keyword)):""!=typeName?$("#search_goods").val(typeName):""!=topTypeName&&$("#search_goods").val(topTypeName),s()});