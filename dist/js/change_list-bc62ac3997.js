function openIndicator(){$.showIndicator(),isIndicator=!0}function hideIndicator(){isIndicator&&($.hideIndicator(),isIndicator=!1),loading=!1}var pageNo=0,pageSize=20,isIndicator=!1,$content=null,loading=!1;$(function(){function s(){pageNo+=1;var s={interId:"toc.getGoodsOnline",channel:"C",sortType:1,filter:3,pageNo:pageNo,pageSize:pageSize};xhq.__runXHQ(s,function(s){0==s.status?(t(s),(null==s.body||s.body.length<pageSize)&&($.detachInfiniteScroll($content),$(".infinite-scroll-preloader").remove()),loading=!1):(hideIndicator(),$.toast(s.message)),hideIndicator()})}function t(s){var t="";if(null!=s.body&&s.body.length>0){for(var i=0;i<s.body.length;i++){var o=s.body[i];1==o.status?t+=e(o):2==o.status&&(t+=n(o))}$(".sale_list .list_container").append(t),a()}}function a(){for(var s=0;s<$(".progress").length;s++){var t=$(".progress").width(),a=$(".progress").eq(s).attr("totalStock"),e=$(".progress").eq(s).attr("stock"),n=$(".progress").eq(s).attr("status"),o=i(a,e);if(2==n)$(".progress").eq(s).find(".span_f").attr("style","width:0");else if(o>=1)$(".progress").eq(s).find(".span_f").attr("style","width:4rem;border-radius:8px");else if(0==o)$(".progress").eq(s).find(".span_f").attr("style","width:0");else if(o>=.9)$(".progress").eq(s).find(".span_f").attr("style","width:3.6rem");else{var l=t*o;$(".progress").eq(s).find(".span_f").attr("style","width:"+l+"px")}}}function e(s){var t='<li><a href="goods_detail.html?onlineId='+s.onlineId+"&"+xhq.getVersion()+'" class="selling_item ongoing external" data-transition="slide-in"><div class="selling_pic"><img src='+s.ImageUrl+'></div><div class="selling_text"><div class="selling_title">'+s.showName+'</div><div class="price_detail"><div class="price_one"><p class="change_price"><span>换购价</span><span class="change_span">&yen;'+s.salePrice/100+"</span><s>&yen;"+s.purchasePrice/100+"</s></p>",a=i(s.totalStock,s.stock);if(a>=1)t+='<p class="progress" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'"><span class="span_f" style="width:4rem;border-radius:8px">';else{var e=4*a;0==a&&(t+='<p class="progress" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'" style="background:rgba(0,0,0,0.25)"><span class="span_f" style="width:0">'),t+=a>=.9?'<p class="progress" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'"><span class="span_f" style="width:3.6rem">':'<p class="progress" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'"><span class="span_f" style="width:'+e+'rem">'}return t+='</span><span class="span_s">剩余<span>'+s.stock+'</span>个</span> </p></div><div class="go_change">立即换购</div></div></div></a></li>'}function n(s){var t='<li><a href="goods_detail.html?onlineId='+s.onlineId+"&"+xhq.getVersion()+'" class="selling_item over external" data-transition="slide-in"><div class="selling_pic"><img src='+s.ImageUrl+'></div><div class="selling_text"><div class="selling_title">'+s.showName+'</div><div class="price_detail"><div class="price_one"><p class="change_price"><span>换购价</span><span class="change_span">&yen;'+s.salePrice/100+"</span><s>&yen;"+s.purchasePrice/100+'</s></p><p class="progress" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'" stype="background:rgba(0,0,0,0.25)"><span class="span_f" stype="width:0"></span><span class="span_s">剩余<span>0</span>个</span></p></div><div class="go_change">立即换购</div></div></div></a></li>';return t}function i(s,t){return 0==s?1:t/s}return xhq.isCustomer()?($(document).on("pageInit","#page-ptr",function(t,a,e){$content=$(e).find(".sale_list"),$(e).on("infinite",function(t){loading||(openIndicator(),loading=!0,setTimeout(function(){s(),$.refreshScroller()},1e3))})}),$.init(),openIndicator(),void s()):void xhq.gotoRegUrl()});