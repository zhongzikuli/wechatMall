function getTommow(){var s=new Date;return s.setDate(s.getDate()+1),s.getFullYear()+"-"+(s.getMonth()+1<10?"0":"")+(s.getMonth()+1)+"-"+((s.getDate()<10?"0":"")+s.getDate())}function openIndicator(){$.showIndicator(),isIndicator=!0}function hideIndicator(){isIndicator&&($.hideIndicator(),isIndicator=!1),loading=!1}var pageNo=0,pageSize=20,curdate=xhq.getToday(),isIndicator=!1,isAppendMode=1,$content=null,loading=!1,curtab=1;$(function(){function s(){pageNo+=1;var s={interId:"toc.getGoodsOnline",channel:"C",date:curdate,sortType:1,filter:1,pageNo:pageNo,pageSize:pageSize,isWs:1,custId:getLocalSession("custId")};xhq.__runXHQ(s,function(s){0==s.status?(t(s),(null==s.body||s.body.length<pageSize)&&($.detachInfiniteScroll($content),$(".infinite-scroll-preloader").remove()),loading=!1):(hideIndicator(),$.toast(s.message)),hideIndicator()})}function t(s){var t="";if(0==isAppendMode&&($(".content-block .list_container").html(""),isAppendMode=1),null!=s.body&&s.body.length>0){for(var o=0;o<s.body.length;o++){var i=s.body[o];t+=1==i.isOnline?n(i):a(i)}$(".content-block .list_container").append(t)}}function a(s){var t='<li class="ws_li"><a href="goods_detail.html?onlineId='+s.onlineId+"&"+xhq.getVersion()+'" class="item-link list-button external"><div class="li_l"><img src='+s.ImageUrl+' alt=""></div><div class="li_r"><div class="up_con">'+s.showName+'</div><div class="mid_con"><div class="pri_l"><p>¥<span class="pri_one">'+s.salePrice/100+'</span><s>¥<span class="pri_two">'+s.purchasePrice/100+'</span></s></p></div><div class="pri_r">赚: ¥<span>'+s.bonus/100+'</span></div></div><div class="down_con"><div class="sur_l">';if(s.stock<=0)t+='<p class="surplus" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="0" style="background: rgb(255,255,255)"><span class="span_f" style="background: rgba(0,0,0,0.4);width:4.5rem" ></span><span class="span_s">剩余<span>0</span>个</span>';else{var a=o(s.totalStock,s.stock);t+=1==a?'<p class="surplus" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'"><span class="span_f" style="width:4.5rem;border-radius: 8px"></span><span class="span_s">剩余<span>'+s.stock+"</span>个</span>":a>.9&&a<1?'<p class="surplus" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'"><span class="span_f" style="width:4.05rem;border-radius: 8px 0 0 8px"></span><span class="span_s">剩余<span>'+s.stock+"</span>个</span>":'<p class="surplus" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'"><span class="span_f" style="width:'+4.5*a+'rem;border-radius: 8px 0 0 8px" ></span><span class="span_s">剩余<span>'+s.stock+"</span>个</span>"}return t+='</p></div></div></div></a><div class="sur_r uptoshop" data_id='+s.onlineId+'><img src="../img/icon_shi.png" alt=""></div></li>'}function n(s){var t='<li class="lied"><a href="goods_detail.html?onlineId='+s.onlineId+"&"+xhq.getVersion()+'" class="item-link list-button external"><div class="li_l"><img src='+s.ImageUrl+' alt=""></div><div class="li_r"><div class="up_con">'+s.showName+'</div><div class="mid_con"><div class="pri_l"><p>¥<span class="pri_one">'+s.salePrice/100+'</span><s>¥<span class="pri_two">'+s.purchasePrice/100+'</span></s></p></div><div class="pri_r">赚: ¥<span>'+s.bonus/100+'</span></div></div><div class="down_con"><div class="sur_l">';if(s.stock<=0)t+='<p class="surplus" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="0" style="background: rgb(255,255,255)"><span class="span_f" style="background: rgba(0,0,0,0.4);width:4.5rem" ></span><span class="span_s">剩余<span>0</span>个</span>';else{var a=o(s.totalStock,s.stock);t+=1==a?'<p class="surplus" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'"><span class="span_f" style="width:4.5rem;border-radius: 8px"></span><span class="span_s">剩余<span>'+s.stock+"</span>个</span>":a>.9&&a<1?'<p class="surplus" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'"><span class="span_f" style="width:4.05rem;border-radius: 8px 0 0 8px"></span><span class="span_s">剩余<span>'+s.stock+"</span>个</span>":'<p class="surplus" status="'+s.status+'" totalStock="'+s.totalStock+'" stock="'+s.stock+'"><span class="span_f" style="width:'+4.5*a+'rem;border-radius: 8px 0 0 8px" ></span><span class="span_s">剩余<span>'+s.stock+"</span>个</span>"}return t+='</p></div></div></div></a><div class="sur_r">已添加</div></li>'}function o(s,t){return 0==s?1:t/s}2!=getLocalSession("userType")&&$.alert("亲，您尚未注册成为全民集市的店长，请先注册","温馨提醒",function(){xhq.gotoRegUrl()}),2==xhq.getQuery("fromUserType")||$("#toshop").hide(),$(document).on("pageInit","#page-ptr",function(t,a,n){$content=$(n).find(".content-block"),$(n).on("infinite",function(t){loading||(openIndicator(),loading=!0,setTimeout(function(){isAppendMode=1,s(),$.refreshScroller()},1e3))})}),$.init(),$(".today").on("tap",function(){1!=curtab&&($(this).addClass("active").siblings().removeClass("active"),$(this).find("img").attr("src","../img/icon_fire.png"),pageNo=0,isAppendMode=0,curdate=xhq.getToday(),curtab=1,openIndicator(),$.attachInfiniteScroll($content),s())}),$(".tomorrow").on("tap",function(){2!=curtab&&($(this).addClass("active"),$(".today").removeClass("active"),$(".today").find("img").attr("src","../img/icon_fire2.png"),pageNo=0,isAppendMode=0,curdate=getTommow(),curtab=2,openIndicator(),$.attachInfiniteScroll($content),s())}),openIndicator();var i='<div class="swiper-wrapper">',e={interId:"toc.getIndexBanners",channel:"C"};xhq.__runXHQ(e,function(t){if(0==t.status){if(null!=t.body&&t.body.length>0)for(var a=0;a<t.body.length;a++){var n=t.body[a];i=2==n.actType?i+'<div class="swiper-slide"><a href="ws_banner_detail.html?actId='+n.actId+"&r="+Math.random()+"&"+xhq.getVersion()+'"><img src='+n.imgUrl+' alt=""></a></div>':i+'<div class="swiper-slide"><a class="external" href="'+n.linkUrl+'"><img src='+n.imgUrl+' alt=""></a></div>'}if(i+='</div><div class="swiper-pagination"></div>',$(".swiper-container").html(i),t.body.length>1){new Swiper(".swiper-container",{pagination:".swiper-pagination",paginationClickable:!0,spaceBetween:30,centeredSlides:!0,autoplay:2500,autoplayDisableOnInteraction:!1})}s()}else hideIndicator(),$.toast(t.message)}),$("#tome").on("tap",function(){xhq.gotoUrl("ws_me.html")}),$("#totour").on("tap",function(){xhq.gotoUrl("tour.html")}),$("#totype").on("tap",function(){xhq.gotoUrl("goodtypes.html")}),$(".list_container").on("tap","li .uptoshop",function(){var s=$(this),t=$(this).attr("data_id"),a={interId:"toc.custUpOnline",channel:"C",custId:getLocalSession("custId"),onlineId:t};$.showIndicator(),xhq.__runXHQ(a,function(t){$.hideIndicator(),0==t.status?(s.removeClass("uptoshop"),s.parent().removeClass("ws_li"),s.parent().addClass("lied"),s.html("已添加"),$.toast("上架成功")):$.toast(t.message)})}),$("#toshop").on("tap",function(){xhq.gotoUrl("ws_shop.html")})});